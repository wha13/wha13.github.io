<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Before allRank: 27Team: ICEDTEAI participated in this cute CTF with ICEDTEA as my last CTF before chinese new year, and I almost AK all Crypto Challenges … (Except BabyRNG)After all, I really love the">
<meta property="og:type" content="article">
<meta property="og:title" content="x3CTF 2025 (feat. mvm) Writeup">
<meta property="og:url" content="http://wha13.github.io/2025/01/27/x3ctf-2025/index.html">
<meta property="og:site_name" content="Whale120&#39;s Blog">
<meta property="og:description" content="Before allRank: 27Team: ICEDTEAI participated in this cute CTF with ICEDTEA as my last CTF before chinese new year, and I almost AK all Crypto Challenges … (Except BabyRNG)After all, I really love the">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hackmd.io/_uploads/r1RbNzrdyg.png">
<meta property="og:image" content="https://hackmd.io/_uploads/BJAuMmrdyx.png">
<meta property="og:image" content="https://hackmd.io/_uploads/Hkwnm7S_yl.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyG1VQHu1x.png">
<meta property="og:image" content="https://hackmd.io/_uploads/SyZ44Xru1e.png">
<meta property="article:published_time" content="2025-01-27T16:52:22.000Z">
<meta property="article:modified_time" content="2025-01-27T15:43:47.447Z">
<meta property="article:author" content="William Lin">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Cryptography">
<meta property="article:tag" content="LLL">
<meta property="article:tag" content="ECC">
<meta property="article:tag" content="Permutation Group">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.io/_uploads/r1RbNzrdyg.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>x3CTF 2025 (feat. mvm) Writeup</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/02/09/eof-final-2025/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/01/27/alpacahack-9/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2025/01/27/x3ctf-2025/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&text=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&is_video=false&description=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=x3CTF 2025 (feat. mvm) Writeup&body=Check out this article: http://wha13.github.io/2025/01/27/x3ctf-2025/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&name=x3CTF 2025 (feat. mvm) Writeup&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2025/01/27/x3ctf-2025/&t=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Writeup"><span class="toc-number">2.</span> <span class="toc-text">Writeup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#man-vs-matrix"><span class="toc-number">3.1.</span> <span class="toc-text">man-vs-matrix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sourceless-crypto"><span class="toc-number">3.2.</span> <span class="toc-text">sourceless-crypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#curved-mvm"><span class="toc-number">3.3.</span> <span class="toc-text">curved-mvm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fastcrypto"><span class="toc-number">3.4.</span> <span class="toc-text">fastcrypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rubiks-dsa"><span class="toc-number">3.5.</span> <span class="toc-text">rubiks-dsa</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">4.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#submission"><span class="toc-number">4.1.</span> <span class="toc-text">submission</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mvm"><span class="toc-number">5.1.</span> <span class="toc-text">mvm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trophy-plus"><span class="toc-number">5.2.</span> <span class="toc-text">trophy-plus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trophy-plus64"><span class="toc-number">5.3.</span> <span class="toc-text">trophy-plus64</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        x3CTF 2025 (feat. mvm) Writeup
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">William Lin</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-01-27T16:52:22.000Z" class="dt-published" itemprop="datePublished">2025-01-27</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>, <a class="p-category" href="/tags/Cryptography/" rel="tag">Cryptography</a>, <a class="p-category" href="/tags/ECC/" rel="tag">ECC</a>, <a class="p-category" href="/tags/LLL/" rel="tag">LLL</a>, <a class="p-category" href="/tags/Permutation-Group/" rel="tag">Permutation Group</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Before-all"><a href="#Before-all" class="headerlink" title="Before all"></a>Before all</h2><p>Rank: 27<br>Team: ICEDTEA<br>I participated in this cute CTF with ICEDTEA as my last CTF before chinese new year, and I almost AK all Crypto Challenges … (Except BabyRNG)<br>After all, I really love these cute challenges and they can also be a good piece of lecture to my junior teammates in ICEDTEA!  </p>
<h2 id="Writeup"><a href="#Writeup" class="headerlink" title="Writeup"></a>Writeup</h2><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="man-vs-matrix"><a href="#man-vs-matrix" class="headerlink" title="man-vs-matrix"></a>man-vs-matrix</h3><p><strong>challenge.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RNG</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.p = next_prime(<span class="number">2</span>**<span class="number">24</span>)</span><br><span class="line">        self.F = GF(self.p)</span><br><span class="line">        self.M = matrix(self.F, <span class="number">3</span>,<span class="number">3</span>, [bytes_to_long(seed[i:i+<span class="number">3</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(seed), <span class="number">3</span>)])</span><br><span class="line">        self.state = vector(self.F, <span class="built_in">map</span>(<span class="built_in">ord</span>, <span class="string">&quot;Mvm&quot;</span>))</span><br><span class="line">        self.gen = self.F(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_random_num</span>(<span class="params">self</span>):</span><br><span class="line">        out = self.M * self.state</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self.state)):</span><br><span class="line">            self.state[i] = self.gen**self.state[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out * self.state</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;MVM&#123;???????????????????????????&#125;&quot;</span></span><br><span class="line">seed = flag[<span class="number">4</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">rng = RNG(seed)</span><br><span class="line">samples = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    samples.append(rng.get_random_num())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;samples = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># samples = [6192533, 82371, 86024, 4218430, 12259879, 16442850, 6736271, 7418630, 15483781]</span></span><br></pre></td></tr></table></figure>

<p>This is a RNG with an initial state “Mvm” with every <code>3*3</code> matrix input (splitted from the flag with 3 chars a set).<br>It’s trivial that the state is always predictable in the 9 operations <code>rng.get_random_num()</code>(exponential), and the output value is actually a linear sum with the input matrix and <code>old state</code>*<code>new state</code> as paired parameters.<br>With 9 output values, the problem would become an easy linear equation (because there’re also 9 unknown variables).<br><strong>exp.sage</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">samples=[<span class="number">6192533</span>, <span class="number">82371</span>, <span class="number">86024</span>, <span class="number">4218430</span>, <span class="number">12259879</span>, <span class="number">16442850</span>, <span class="number">6736271</span>, <span class="number">7418630</span>, <span class="number">15483781</span>]</span><br><span class="line">p=next_prime(<span class="number">2</span>**<span class="number">24</span>)</span><br><span class="line">F=GF(p)</span><br><span class="line">gen=F(<span class="number">2</span>)</span><br><span class="line">state = vector(F, <span class="built_in">map</span>(<span class="built_in">ord</span>, <span class="string">&quot;Mvm&quot;</span>))</span><br><span class="line">params=[]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_params</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        old_state=[_ <span class="keyword">for</span> _ <span class="keyword">in</span> state]</span><br><span class="line">        cur=[]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(state)):</span><br><span class="line">            state[j]=gen**state[j]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">                cur.append(state[j]*old_state[k])</span><br><span class="line">        params.append(cur)</span><br><span class="line"></span><br><span class="line">gen_params()</span><br><span class="line">M=Matrix(F, params)</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> M.solve_right(samples):</span><br><span class="line">    flag+=long_to_bytes(<span class="built_in">int</span>(i)).decode()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h3 id="sourceless-crypto"><a href="#sourceless-crypto" class="headerlink" title="sourceless-crypto"></a>sourceless-crypto</h3><p>A black box crypto challenge…<br>First tested with ‘aaaaaa…’ and found out the key value is in some order(like increasing but not), also the max input size is 197 chars (<code>256-len(flag)</code>), so the key may be a permutation of ASCII chars.<br>Later tested with ‘abcdef…’ and obtained something like this:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Welcome to sourceless-crypto, enjoy the pain</span><br><span class="line">1 -&gt; Show Flag</span><br><span class="line">2 -&gt; Encrypt Plaintext</span><br><span class="line">3 -&gt; exit</span><br><span class="line">Operation: 2</span><br><span class="line">Enter plaintext: abcdefghijklmnopqrstuvwxyz</span><br><span class="line">Encrypted plaintext: b&#x27;KOOKK77;;??;;77++//++77;;?&#x27;</span><br></pre></td></tr></table></figure>
<p>Cool, some repeated pairs of charaters appeared many times,  maybe about bitwise operation…XOR?! (because of the LSB, and I guessed the key is in some kind of order)<br>To prove my concept, directly connected to the server two times with diffrent inputs, the xor value between the ciphertext and plaintext are all the same, tada~<br>Last, just observed that the key permutation is a change of order from <code>0123</code> to <code>0132</code> (same for other sets of numbers).<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line">dataset=<span class="string">&#x27;1032547698badcfe&#x27;</span></span><br><span class="line">key=<span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dataset:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dataset:</span><br><span class="line">        key+=<span class="built_in">bytes</span>.fromhex(i+j)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(xor(enc, key))</span><br></pre></td></tr></table></figure>
<p><del>This challenge should be renamed to <strong>GUESSY-crypto</strong></del><br>Btw, I love this sense of humor!<br><img src="https://hackmd.io/_uploads/r1RbNzrdyg.png" alt="image">  </p>
<h3 id="curved-mvm"><a href="#curved-mvm" class="headerlink" title="curved-mvm"></a>curved-mvm</h3><p>A signer based on fastecdsa.<br>Player have two operation chances and the operations are:  </p>
<ol>
<li>Obtain a signed message.</li>
<li>Sign a specify message back, check the value and get the flag if correct.</li>
</ol>
<p><strong>server.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> dumps</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbits</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line">FLAG = os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;MVM&#123;f4ke_fl4g&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a wonderful curve</span></span><br><span class="line">p = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">a = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC</span></span><br><span class="line">b = <span class="number">0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B</span></span><br><span class="line">Gx = <span class="number">0x6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296</span></span><br><span class="line">Gy = <span class="number">0x4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5</span></span><br><span class="line"></span><br><span class="line">F = GF(p)</span><br><span class="line">EC = EllipticCurve(F, [a, b])</span><br><span class="line">n = EC.order()</span><br><span class="line"></span><br><span class="line">SECRET_KEY = bytes_to_long(os.urandom(<span class="number">69420</span>)) % n</span><br><span class="line">G = EC([Gx, Gy])</span><br><span class="line"><span class="keyword">assert</span> G <span class="keyword">in</span> EC</span><br><span class="line"></span><br><span class="line">Q = SECRET_KEY * G</span><br><span class="line"></span><br><span class="line">FUNNY_CREDITS_FOR_FREE_TRIAL = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">CHALL_NAME = <span class="string">&quot;Curved MVM&quot;</span></span><br><span class="line"></span><br><span class="line">K_SIZE = <span class="number">18</span></span><br><span class="line">SAMPLE_MSG = <span class="string">&quot;hardcoded cuz reasons&quot;</span></span><br><span class="line">REQUIRED_MSG = <span class="string">&quot;mvm mvm mvm&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign_msg</span>(<span class="params">msg: <span class="built_in">str</span></span>):</span><br><span class="line">    z = bytes_to_long(sha1(msg.encode()).digest()) % n</span><br><span class="line">    k = (randbits(K_SIZE) + <span class="number">2</span>) % n</span><br><span class="line">    R = k * G</span><br><span class="line">    r = ZZ(R.x()) % n</span><br><span class="line">    s = (k.inverse_mod(n) * (z + r * SECRET_KEY)) % n</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;r&quot;</span>: <span class="built_in">hex</span>(r), <span class="string">&quot;s&quot;</span>: <span class="built_in">hex</span>(s)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign_bogus</span>():</span><br><span class="line">    <span class="keyword">return</span> sign_msg(SAMPLE_MSG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_signature</span>(<span class="params">r, s, msg</span>):</span><br><span class="line">    z = bytes_to_long(sha1(msg.encode()).digest()) % n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> r &lt; <span class="number">1</span> <span class="keyword">or</span> r &gt;= n <span class="keyword">or</span> s &lt; <span class="number">1</span> <span class="keyword">or</span> s &gt;= n:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;funny user uwu&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    w = s.inverse_mod(n)</span><br><span class="line"></span><br><span class="line">    u1 = (z * w) % n</span><br><span class="line">    u2 = (r * w) % n</span><br><span class="line"></span><br><span class="line">    P = u1 * G + u2 * Q</span><br><span class="line"></span><br><span class="line">    should_r = ZZ(P.x()) % n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> should_r == r:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;flag&quot;</span>: FLAG&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># user funny</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;invalid signature&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mvm</span>():</span><br><span class="line">    r = prompt_integer(<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    s = prompt_integer(<span class="string">&quot;s&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> verify_signature(r, s, REQUIRED_MSG)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;funny user&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">operations = &#123;</span><br><span class="line">    <span class="string">&quot;sign&quot;</span>: sign_bogus,</span><br><span class="line">    <span class="string">&quot;mvm&quot;</span>: mvm,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prompt_operation</span>():</span><br><span class="line">    _prompt = <span class="string">&quot;/&quot;</span>.join(operations)</span><br><span class="line">    prompt = <span class="string">f&quot;(<span class="subst">&#123;_prompt&#125;</span>): &quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        recv = <span class="built_in">input</span>(prompt)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;user too funny, complaints will be ignored\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> recv <span class="keyword">not</span> <span class="keyword">in</span> operations:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;funny operation\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> prompt_operation()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> operations[recv]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prompt_integer</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    prompt = <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>: &quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        recv = <span class="built_in">input</span>(prompt)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;user too funny, complaints will be sent to /dev/null\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> prompt_integer(name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        number = <span class="built_in">int</span>(recv, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;user supplied number too funny, complaints will be ignored\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> prompt_integer(name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;user supplied number funny.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> prompt_integer(name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ZZ(number)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">funny_credits = FUNNY_CREDITS_FOR_FREE_TRIAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Welcome to <span class="subst">&#123;CHALL_NAME!r&#125;</span>, enjoy the pain!\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">f&quot;You have <span class="subst">&#123;funny_credits&#125;</span> funny credit<span class="subst">&#123;<span class="string">&#x27;s&#x27;</span> <span class="keyword">if</span> funny_credits &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>.&quot;</span></span><br><span class="line">        )</span><br><span class="line">        operation = prompt_operation()</span><br><span class="line">        <span class="built_in">print</span>(dumps(operation()))</span><br><span class="line">        funny_credits -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> funny_credits == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ran out of funny credits, bye&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>Take a close look at function <code>sign_msg</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sign_msg</span>(<span class="params">msg: <span class="built_in">str</span></span>):</span><br><span class="line">    z = bytes_to_long(sha1(msg.encode()).digest()) % n</span><br><span class="line">    k = (randbits(K_SIZE) + <span class="number">2</span>) % n</span><br><span class="line">    R = k * G</span><br><span class="line">    r = ZZ(R.x()) % n</span><br><span class="line">    s = (k.inverse_mod(n) * (z + r * SECRET_KEY)) % n</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;r&quot;</span>: <span class="built_in">hex</span>(r), <span class="string">&quot;s&quot;</span>: <span class="built_in">hex</span>(s)&#125;</span><br></pre></td></tr></table></figure>
<p>We would get the value of R, since the value of k is too small, it’s feasible to bruteforce&#x2F;discrete_log on R and obtain the value of k.<br>After that, the value of k, z, r, n are all known so the value of SECRET_KEY would be leaked, just simply sign a message back and get flag!<br><strong>exp.sage</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> dumps</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbits</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">a = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC</span></span><br><span class="line">b = <span class="number">0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B</span></span><br><span class="line">Gx = <span class="number">0x6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296</span></span><br><span class="line">Gy = <span class="number">0x4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5</span></span><br><span class="line"></span><br><span class="line">K_SIZE = <span class="number">18</span></span><br><span class="line">SECRET_KEY = <span class="number">0x7ea</span></span><br><span class="line">F = GF(p)</span><br><span class="line">EC = EllipticCurve(F, [a, b])</span><br><span class="line">n = EC.order()</span><br><span class="line"></span><br><span class="line">G = EC([Gx, Gy])</span><br><span class="line"><span class="keyword">assert</span> G <span class="keyword">in</span> EC</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">x2point</span>(<span class="params">q_x</span>):</span><br><span class="line">    y_2 = (<span class="built_in">pow</span>(q_x,<span class="number">3</span>) + a*q_x + b) % p</span><br><span class="line">    q_y = <span class="built_in">pow</span>(y_2, (p+<span class="number">1</span>)//<span class="number">4</span>, p)</span><br><span class="line">    Q = EC([q_x, q_y])</span><br><span class="line">    <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_secret</span>(<span class="params">r, s</span>):</span><br><span class="line">    z = bytes_to_long(sha1(<span class="string">&quot;hardcoded cuz reasons&quot;</span>.encode()).digest()) % n</span><br><span class="line">    R = x2point(r)</span><br><span class="line">    randkey = discrete_log(x2point(r), G, G.order(), operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">    secret_key = (randkey*s-z)*inverse(r, n)%n</span><br><span class="line">    <span class="keyword">return</span> secret_key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign_msg</span>(<span class="params">msg: <span class="built_in">str</span></span>):</span><br><span class="line">    z = bytes_to_long(sha1(msg.encode()).digest()) % n</span><br><span class="line">    k = (randbits(K_SIZE) + <span class="number">2</span>) % n</span><br><span class="line">    R = k * G</span><br><span class="line">    r = ZZ(R[<span class="number">0</span>]) % n</span><br><span class="line">    s = (k.inverse_mod(n) * (z + r * SECRET_KEY)) % n</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;r&quot;</span>: <span class="built_in">hex</span>(r), <span class="string">&quot;s&quot;</span>: <span class="built_in">hex</span>(s)&#125;</span><br><span class="line"></span><br><span class="line">r = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;r &gt;&gt; &quot;</span>), <span class="number">16</span>)</span><br><span class="line">s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;s &gt;&gt; &quot;</span>), <span class="number">16</span>)</span><br><span class="line">SECRET_KEY=find_secret(r, s)</span><br><span class="line"><span class="built_in">print</span>(sign_msg(<span class="string">&quot;mvm mvm mvm&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>With connection by hand.  </p>
<h3 id="fastcrypto"><a href="#fastcrypto" class="headerlink" title="fastcrypto"></a>fastcrypto</h3><p>An RSA CRT service which it’s multiplication is based on NTT Algorithm.<br><strong>chall.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long <span class="keyword">as</span> btl, inverse</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbits</span><br><span class="line"><span class="keyword">from</span> nttmul <span class="keyword">import</span> conv</span><br><span class="line"><span class="keyword">from</span> SECRET <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line">TIMEOUT = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">B = <span class="number">7639</span> <span class="comment"># chosen by fair dice roll</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fromPoly</span>(<span class="params">arr</span>):</span><br><span class="line">	num = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(arr))):</span><br><span class="line">		num *= B</span><br><span class="line">		num += arr[idx]</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">toPoly</span>(<span class="params">num</span>):</span><br><span class="line">	arr = []</span><br><span class="line">	<span class="keyword">while</span> num != <span class="number">0</span>:</span><br><span class="line">		num, tmp = <span class="built_in">divmod</span>(num, B)</span><br><span class="line">		arr.append(tmp)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> arr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">	aPoly = toPoly(a)</span><br><span class="line">	bPoly = toPoly(b)</span><br><span class="line">	cPoly = conv(aPoly, bPoly)</span><br><span class="line">	<span class="keyword">return</span> fromPoly(cPoly)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modpow</span>(<span class="params">base: <span class="built_in">int</span>, ex: <span class="built_in">int</span>, mod: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">	ret = <span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span> ex:</span><br><span class="line">		<span class="keyword">if</span> ex &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">			ret = multiply(ret, base)</span><br><span class="line">			ret %= mod</span><br><span class="line">		base = multiply(base, base)</span><br><span class="line">		base %= mod</span><br><span class="line">		ex &gt;&gt;= <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">p: <span class="built_in">int</span>, q: <span class="built_in">int</span>, e: <span class="built_in">int</span>, data: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">	encp = modpow(data % p, e, p)</span><br><span class="line">	encq = modpow(data % q, e, q)</span><br><span class="line">	pInvQ = inverse(p, q)</span><br><span class="line">	qInvP = inverse(q, p)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (encp * qInvP * q + encq * pInvQ * p) % (p * q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:	</span><br><span class="line">	p = getPrime(<span class="number">512</span>)</span><br><span class="line">	q = getPrime(<span class="number">512</span>)</span><br><span class="line">	N = p * q</span><br><span class="line">	e = <span class="number">0x10001</span></span><br><span class="line">	FLAG = btl(FLAG)</span><br><span class="line">	signal.alarm(TIMEOUT)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;### FASTCRYPTO ###&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;N = &#125;</span>&#x27;</span>)</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;1. Get flag\n2. Encrypt data\n3. Exit&#x27;</span>)</span><br><span class="line">		choice = <span class="built_in">input</span>(<span class="string">&#x27;choice: &#x27;</span>)</span><br><span class="line">		<span class="keyword">assert</span> choice == <span class="string">&#x27;1&#x27;</span> <span class="keyword">or</span> choice == <span class="string">&#x27;2&#x27;</span> <span class="keyword">or</span> choice == <span class="string">&#x27;3&#x27;</span></span><br><span class="line">		<span class="keyword">if</span> choice == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">			data = randbits(<span class="number">1024</span>)</span><br><span class="line">			enc = encrypt(p, q, e, data)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;enc = &#125;</span>&#x27;</span>)</span><br><span class="line">			decryptedData = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;pt: &#x27;</span>))</span><br><span class="line">			<span class="keyword">assert</span> data == decryptedData</span><br><span class="line"></span><br><span class="line">			enc = encrypt(p, q, e, FLAG)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;enc = &#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> choice == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">			data = randbits(<span class="number">1024</span>)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;data = &#125;</span>&#x27;</span>)</span><br><span class="line">			enc = encrypt(p, q, e, data)</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;enc = &#125;</span>&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			exit()</span><br></pre></td></tr></table></figure>

<p>Is suspecious of chosing a B value 7639, an uncommon prime which is quite too small and would have some bias while encountering higher coefficients.<br>So it’s probably feasible to do a RSA Fault Attack if the output value is wrong!<br>The exploit tells everything ⬇️.<br><strong>exp.py</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">host=<span class="string">&#x27;947b7890-af59-40d2-83c2-ac750bf0ac26.x3c.tf&#x27;</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    data=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">    r=remote(host, <span class="number">31337</span>, ssl=<span class="literal">True</span>)</span><br><span class="line">    r.recvline()</span><br><span class="line">    predict=[]</span><br><span class="line">    n=<span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27; = &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">        r.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">        cur_data=<span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27; = &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">        cur_enc=<span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27; = &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(cur_data, e, n)!=cur_enc: <span class="comment"># check if it has bias</span></span><br><span class="line">            <span class="comment">#return f&quot;&#123;cur_data=&#125;\n&#123;cur_enc=&#125;\n&#123;n&#125;&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    p=math.gcd(<span class="built_in">pow</span>(cur_data, e, n)-cur_enc, n) <span class="comment"># calculate the secret key value</span></span><br><span class="line">    <span class="keyword">assert</span> n%p==<span class="number">0</span> <span class="keyword">and</span> isPrime(p)</span><br><span class="line">    q=n//p</span><br><span class="line">    d=inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;: &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    chal=<span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27; = &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(<span class="built_in">pow</span>(chal, d, n)).encode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;d=&#125;</span>\n<span class="subst">&#123;n=&#125;</span>&quot;</span>)</span><br><span class="line">    eflag=<span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27; = &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(eflag, d, n)))</span><br><span class="line"><span class="comment">#    r.interactive()</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(exploit())</span><br></pre></td></tr></table></figure>

<h3 id="rubiks-dsa"><a href="#rubiks-dsa" class="headerlink" title="rubiks-dsa"></a>rubiks-dsa</h3><p>A cute cryptosystem based on rubiks cube ?!<br><del>Thanks for telling me there’re rubiks inside sage</del>, I love this one!<br><strong>chall.sage</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">rubik_moves = <span class="string">&quot;B&#x27; U  B&#x27; R  F2 &quot;</span></span><br><span class="line">P = Permutation(<span class="built_in">eval</span>(<span class="built_in">open</span>(<span class="string">&quot;permutation.txt&quot;</span>).read())).to_permutation_group_element()</span><br><span class="line">forbidden = [<span class="number">2</span>, <span class="number">27</span>, <span class="number">45</span>, <span class="number">56</span>, <span class="number">70</span>, <span class="number">86</span>, <span class="number">94</span>, <span class="number">138</span>, <span class="number">140</span>, <span class="number">167</span>, <span class="number">182</span>, <span class="number">232</span>, <span class="number">283</span>, <span class="number">284</span>, <span class="number">306</span>, <span class="number">308</span>, <span class="number">335</span>, <span class="number">348</span>, <span class="number">350</span>, <span class="number">363</span>, <span class="number">378</span>, <span class="number">423</span>, <span class="number">428</span>, <span class="number">446</span>, <span class="number">452</span>, <span class="number">506</span>, <span class="number">507</span>, <span class="number">536</span>, <span class="number">544</span>, <span class="number">560</span>, <span class="number">578</span>, <span class="number">579</span>, <span class="number">585</span>, <span class="number">587</span>, <span class="number">590</span>, <span class="number">592</span>, <span class="number">619</span>, <span class="number">642</span>, <span class="number">670</span>, <span class="number">675</span>, <span class="number">702</span>, <span class="number">731</span>, <span class="number">732</span>, <span class="number">738</span>, <span class="number">758</span>, <span class="number">760</span>, <span class="number">768</span>, <span class="number">770</span>, <span class="number">782</span>, <span class="number">783</span>, <span class="number">814</span>, <span class="number">830</span>, <span class="number">834</span>, <span class="number">843</span>, <span class="number">862</span>, <span class="number">867</span>, <span class="number">927</span>, <span class="number">936</span>, <span class="number">952</span>, <span class="number">980</span>, <span class="number">1010</span>, <span class="number">1038</span>, <span class="number">1091</span>, <span class="number">1119</span>, <span class="number">1148</span>, <span class="number">1150</span>, <span class="number">1152</span>, <span class="number">1170</span>, <span class="number">1174</span>, <span class="number">1175</span>, <span class="number">1188</span>, <span class="number">1190</span>, <span class="number">1204</span>, <span class="number">1206</span>, <span class="number">1222</span>]</span><br><span class="line">n = <span class="number">641154303900</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">spicy_rubik_pow</span>(<span class="params">k</span>):</span><br><span class="line">    C = RubiksCube().move(rubik_moves * (k % <span class="number">1260</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (P * C._state)**k</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_to_int</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(sha256(m.encode()).hexdigest(), <span class="number">16</span>) % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">msg, d</span>):</span><br><span class="line">    k = n</span><br><span class="line">    r_hash = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> gcd(k, n) != <span class="number">1</span> <span class="keyword">or</span> gcd(r_hash, n) != <span class="number">1</span> <span class="keyword">or</span> (k % <span class="number">1260</span>) <span class="keyword">in</span> forbidden:</span><br><span class="line">        k = randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        r = spicy_rubik_pow(k)</span><br><span class="line">        r_hash = hash_to_int(<span class="built_in">str</span>(r))</span><br><span class="line">    </span><br><span class="line">    s = <span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (hash_to_int(msg) + r_hash*d) % n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;MVM&#123;_fakemvmfakemvm_&#125;&quot;</span></span><br><span class="line">flag = flag[<span class="number">4</span>:-<span class="number">1</span>]</span><br><span class="line">privkeys = [randint(<span class="number">0</span>, n) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">16</span></span><br><span class="line"></span><br><span class="line">out = <span class="built_in">open</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    r,s = sign(<span class="string">f&quot;mvm_<span class="subst">&#123;i&#125;</span>&quot;</span>, privkeys[i])</span><br><span class="line"></span><br><span class="line">    out.write(<span class="built_in">str</span>(r) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    out.write(<span class="built_in">str</span>(s) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="number">4</span>):</span><br><span class="line">    secret = vector([flag[i + j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])</span><br><span class="line">    ds = vector(privkeys[i:i+<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">    out.write(<span class="built_in">str</span>(secret * ds) + <span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>Take a look at the <code>spicy_rubik_pow</code> function:  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">spicy_rubik_pow</span>(<span class="params">k</span>):</span><br><span class="line">    C = RubiksCube().move(rubik_moves * (k % <span class="number">1260</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (P * C._state)**k</span><br></pre></td></tr></table></figure>
<p>I would call it a base for every permutation group <code>(P * C._state)**k</code>, and there’re only 1185 bases.<br>After some trials, the order of those bases are quite small, so it’s DLP can be solved with <code>discrete_log</code> function …  </p>
<p>Next is the signer:  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">msg, d</span>):</span><br><span class="line">    k = n</span><br><span class="line">    r_hash = n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> gcd(k, n) != <span class="number">1</span> <span class="keyword">or</span> gcd(r_hash, n) != <span class="number">1</span> <span class="keyword">or</span> (k % <span class="number">1260</span>) <span class="keyword">in</span> forbidden:</span><br><span class="line">        k = randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        r = spicy_rubik_pow(k)</span><br><span class="line">        r_hash = hash_to_int(<span class="built_in">str</span>(r))</span><br><span class="line">    </span><br><span class="line">    s = <span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (hash_to_int(msg) + r_hash*d) % n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> r, s</span><br></pre></td></tr></table></figure>
<p>After solving the value of k from discrete_log of r (brute force all bases and find the right one), the rest values like <code>hash_to_int(msg)</code>, <code>r_hash</code> are trivial so that the value of d can be recovered (which is the secret key).  </p>
<p>Finally is the encryption with those keys:  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="number">4</span>):</span><br><span class="line">    secret = vector([flag[i + j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])</span><br><span class="line">    ds = vector(privkeys[i:i+<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">    out.write(<span class="built_in">str</span>(secret * ds) + <span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>It’s a linear operation with the size of keys are much more larger than ASCII chars, which can simply calculated with LLL after obtained the keys.<br><del>Btw, 4 chars are actually able to brute-force</del>  </p>
<p><strong>sol.sage</strong>  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">rubik_moves=<span class="string">&quot;B&#x27; U  B&#x27; R  F2 &quot;</span></span><br><span class="line">P=Permutation(<span class="built_in">eval</span>(<span class="built_in">open</span>(<span class="string">&quot;permutation.txt&quot;</span>).read())).to_permutation_group_element()</span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&#x27;out.txt&#x27;</span>).read().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">forbidden=[<span class="number">2</span>, <span class="number">27</span>, <span class="number">45</span>, <span class="number">56</span>, <span class="number">70</span>, <span class="number">86</span>, <span class="number">94</span>, <span class="number">138</span>, <span class="number">140</span>, <span class="number">167</span>, <span class="number">182</span>, <span class="number">232</span>, <span class="number">283</span>, <span class="number">284</span>, <span class="number">306</span>, <span class="number">308</span>, <span class="number">335</span>, <span class="number">348</span>, <span class="number">350</span>, <span class="number">363</span>, <span class="number">378</span>, <span class="number">423</span>, <span class="number">428</span>, <span class="number">446</span>, <span class="number">452</span>, <span class="number">506</span>, <span class="number">507</span>, <span class="number">536</span>, <span class="number">544</span>, <span class="number">560</span>, <span class="number">578</span>, <span class="number">579</span>, <span class="number">585</span>, <span class="number">587</span>, <span class="number">590</span>, <span class="number">592</span>, <span class="number">619</span>, <span class="number">642</span>, <span class="number">670</span>, <span class="number">675</span>, <span class="number">702</span>, <span class="number">731</span>, <span class="number">732</span>, <span class="number">738</span>, <span class="number">758</span>, <span class="number">760</span>, <span class="number">768</span>, <span class="number">770</span>, <span class="number">782</span>, <span class="number">783</span>, <span class="number">814</span>, <span class="number">830</span>, <span class="number">834</span>, <span class="number">843</span>, <span class="number">862</span>, <span class="number">867</span>, <span class="number">927</span>, <span class="number">936</span>, <span class="number">952</span>, <span class="number">980</span>, <span class="number">1010</span>, <span class="number">1038</span>, <span class="number">1091</span>, <span class="number">1119</span>, <span class="number">1148</span>, <span class="number">1150</span>, <span class="number">1152</span>, <span class="number">1170</span>, <span class="number">1174</span>, <span class="number">1175</span>, <span class="number">1188</span>, <span class="number">1190</span>, <span class="number">1204</span>, <span class="number">1206</span>, <span class="number">1222</span>]</span><br><span class="line">n=<span class="number">641154303900</span></span><br><span class="line">all_states=[]</span><br><span class="line">int2id=&#123;&#125;</span><br><span class="line">enc_keys=[]</span><br><span class="line">enc_flags=[]</span><br><span class="line"></span><br><span class="line">keys=[]</span><br><span class="line">flags=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_to_int</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(sha256(m.encode()).hexdigest(), <span class="number">16</span>) % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_all_states</span>():</span><br><span class="line">    cur_id=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1260</span>):</span><br><span class="line">        <span class="keyword">if</span> (i <span class="keyword">not</span> <span class="keyword">in</span> forbidden):</span><br><span class="line">            int2id[i]=cur_id</span><br><span class="line">            cur_id+=<span class="number">1</span></span><br><span class="line">            C = RubiksCube().move(rubik_moves * i)</span><br><span class="line">            all_states.append(P * C._state)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_data</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        enc_keys.append(&#123;<span class="string">&#x27;gp&#x27;</span>:PermutationGroupElement(data[i*<span class="number">2</span>]), <span class="string">&#x27;sign&#x27;</span>:<span class="built_in">int</span>(data[i*<span class="number">2</span>+<span class="number">1</span>])&#125;)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        enc_flags.append(<span class="built_in">int</span>(data[<span class="number">64</span>+i]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_key</span>(<span class="params"><span class="built_in">id</span>, gp, sign</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="built_in">len</span>(all_states)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            k=discrete_log(gp, all_states[i])</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] mvm_<span class="subst">&#123;<span class="built_in">id</span>&#125;</span> trying <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">            r_hash=hash_to_int(<span class="built_in">str</span>(gp))</span><br><span class="line">            cur_key=((sign*k-hash_to_int(<span class="string">f&quot;mvm_<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&quot;</span>))*<span class="built_in">pow</span>(r_hash, -<span class="number">1</span>, n))%n</span><br><span class="line">            keys.append(cur_key)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] mvm_<span class="subst">&#123;<span class="built_in">id</span>&#125;</span> secret cracked!&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">used_keys, out_int</span>):</span><br><span class="line">    <span class="keyword">global</span> flags</span><br><span class="line">    M=[[<span class="number">0</span>]*<span class="number">6</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        M[i][<span class="number">0</span>]=used_keys[i]</span><br><span class="line">        M[i][i+<span class="number">1</span>]=-<span class="number">1</span></span><br><span class="line">    M[<span class="number">4</span>][<span class="number">0</span>]=out_int</span><br><span class="line">    M[<span class="number">4</span>][<span class="number">5</span>]=<span class="number">2</span>**<span class="number">1024</span></span><br><span class="line">    M=Matrix(ZZ, M)</span><br><span class="line">    A=M.LLL()</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> A:</span><br><span class="line">        <span class="keyword">if</span> v[<span class="number">0</span>]==<span class="number">0</span> <span class="keyword">and</span> v[-<span class="number">1</span>]==<span class="number">2</span>**<span class="number">1024</span>:</span><br><span class="line">            flags+=v[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">gen_all_states()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[*] Generated all States&#x27;</span>)</span><br><span class="line">parse_data()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[*] Data Parsed!&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc_keys)):</span><br><span class="line">    crack_key(i, enc_keys[i][<span class="string">&#x27;gp&#x27;</span>], enc_keys[i][<span class="string">&#x27;sign&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    get_flag(keys[i*<span class="number">4</span>:i*<span class="number">4</span>+<span class="number">4</span>], enc_flags[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flags))</span><br></pre></td></tr></table></figure>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="submission"><a href="#submission" class="headerlink" title="submission"></a>submission</h3><p>A web service that user are allowed to uploads <code>.txt</code> files, and they would be moved to <code>/upload</code> folder and:  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;chmod *&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>The flag is also inside <code>/upload</code> folder.<br>Actually, it’s dangerous to use a wildcard parameter like <code>*</code> directly inside a command cuz it would probably leads to a wildcard injection vulnerability.  </p>
<p>For example, if there’s a file named <code>--help</code> inside a folder and doing <code>find *</code>, a manual would pop out cause the <code>--help</code> file name were seen as a parameter passwd to find command<br><img src="https://hackmd.io/_uploads/BJAuMmrdyx.png" alt="image">  </p>
<p>Next, there’s a <code>--reference=&lt;file name&gt;</code> option in chmod command which would change all files into the same permision as <code>&lt;file name&gt;</code>.  </p>
<p>Exploit Step:  </p>
<ol>
<li>upload a file named <code>.txt</code> (be shown as a hidden file in linux file system, won’t be listed in <code>*</code>)  </li>
<li>upload a file named <code>--reference=.txt</code> (change all files permission same as <code>.txt</code>, which would be readable)  </li>
<li>read flag~</li>
</ol>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>Playing with the cert…  </p>
<h3 id="mvm"><a href="#mvm" class="headerlink" title="mvm"></a>mvm</h3><p>Change all M into 0 and V into 1, binary decode and got a piece of brainfuck code, solve them with online decoder.<br><img src="https://hackmd.io/_uploads/Hkwnm7S_yl.png" alt="image">  </p>
<h3 id="trophy-plus"><a href="#trophy-plus" class="headerlink" title="trophy-plus"></a>trophy-plus</h3><p>With the idea from challenge “mvm”, I found that there’re some tiny MVM aroung the cert, probably the same concept?<br><img src="https://hackmd.io/_uploads/SyG1VQHu1x.png" alt="image"><br>And the answer is … yep!<br><del>But tearing my eyes, actually …</del>  </p>
<h3 id="trophy-plus64"><a href="#trophy-plus64" class="headerlink" title="trophy-plus64"></a>trophy-plus64</h3><p><del>Another Human-based OCR</del><br><img src="https://hackmd.io/_uploads/SyZ44Xru1e.png" alt="image"><br>There’s a REAL Certification on the stamp at the corner of the cert, after base decoded the first few lines a flag like string appeared … (Thanks a lot to my teammate wang for this).<br>After that, I just guessed the correct flag!<br><code>&#123;mu5t_b3_feo_typ1ng_th1r_by_h4nd_1375105304248361&#125;</code> &#x3D;&gt; <code>&#123;mu5t_b3_fun_typ1ng_th15_by_h4nd_1375105304248361&#125;</code>  </p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before-all"><span class="toc-number">1.</span> <span class="toc-text">Before all</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Writeup"><span class="toc-number">2.</span> <span class="toc-text">Writeup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#man-vs-matrix"><span class="toc-number">3.1.</span> <span class="toc-text">man-vs-matrix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sourceless-crypto"><span class="toc-number">3.2.</span> <span class="toc-text">sourceless-crypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#curved-mvm"><span class="toc-number">3.3.</span> <span class="toc-text">curved-mvm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fastcrypto"><span class="toc-number">3.4.</span> <span class="toc-text">fastcrypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rubiks-dsa"><span class="toc-number">3.5.</span> <span class="toc-text">rubiks-dsa</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">4.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#submission"><span class="toc-number">4.1.</span> <span class="toc-text">submission</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mvm"><span class="toc-number">5.1.</span> <span class="toc-text">mvm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trophy-plus"><span class="toc-number">5.2.</span> <span class="toc-text">trophy-plus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trophy-plus64"><span class="toc-number">5.3.</span> <span class="toc-text">trophy-plus64</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://wha13.github.io/2025/01/27/x3ctf-2025/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&text=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&is_video=false&description=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=x3CTF 2025 (feat. mvm) Writeup&body=Check out this article: http://wha13.github.io/2025/01/27/x3ctf-2025/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&title=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://wha13.github.io/2025/01/27/x3ctf-2025/&name=x3CTF 2025 (feat. mvm) Writeup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://wha13.github.io/2025/01/27/x3ctf-2025/&t=x3CTF 2025 (feat. mvm) Writeup"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    William Lin
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
